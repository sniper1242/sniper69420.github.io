var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
__.prototype=b.prototype;d.prototype=new __();};var FullScreenMario;(function(FullScreenMario_1){"use strict";var FullScreenMario=(function(_super){__extends(FullScreenMario,_super);function FullScreenMario(settings){this.settings=FullScreenMario.settings;this.deviceMotionStatus={"motionDown":false,"motionLeft":false,"motionRight":false,"x":undefined,"y":undefined,"dy":undefined};_super.call(this,this.proliferate({"constantsSource":FullScreenMario,"constants":["unitsize","scale","gravity","pointLevels","customTextMappings"]},settings));}
FullScreenMario.prototype.resetObjectMaker=function(FSM,settings){FSM.ObjectMaker=new ObjectMakr.ObjectMakr(FSM.proliferate({"properties":{"Quadrant":{"EightBitter":FSM,"GameStarter":FSM,"FSM":FSM},"Thing":{"EightBitter":FSM,"GameStarter":FSM,"FSM":FSM}}},FSM.settings.objects));};FullScreenMario.prototype.resetAudioPlayer=function(FSM,settings){_super.prototype.resetAudioPlayer.call(this,FSM,settings);FSM.AudioPlayer.setGetVolumeLocal(FSM.getVolumeLocal.bind(FSM,FSM));FSM.AudioPlayer.setGetThemeDefault(FSM.getAudioThemeDefault.bind(FSM,FSM));};FullScreenMario.prototype.resetThingHitter=function(FSM,settings){_super.prototype.resetThingHitter.call(this,FSM,settings);FSM.ThingHitter.cacheHitCheckGroup("Solid");FSM.ThingHitter.cacheHitCheckGroup("Character");};FullScreenMario.prototype.resetMapsHandler=function(FSM,settings){FSM.MapsHandler=new MapsHandlr.MapsHandlr({"MapsCreator":FSM.MapsCreator,"MapScreener":FSM.MapScreener,"screenAttributes":FSM.settings.maps.screenAttributes,"onSpawn":FSM.settings.maps.onSpawn.bind(FSM),"stretchAdd":FSM.mapAddStretched.bind(FSM),"afterAdd":FSM.mapAddAfter.bind(FSM)});};FullScreenMario.prototype.resetItemsHolder=function(FSM,settings){_super.prototype.resetItemsHolder.call(this,FSM,settings);if(settings.width<560){FSM.ItemsHolder.getContainer().children[0].cells[4].style.display="none";}};FullScreenMario.prototype.resetMathDecider=function(FSM,customs){FSM.MathDecider=new MathDecidr.MathDecidr(FSM.proliferate({"constants":FSM.MapScreener},FSM.settings.math));};FullScreenMario.prototype.resetContainer=function(FSM,settings){_super.prototype.resetContainer.call(this,FSM,settings);FSM.container.style.fontFamily="Press Start";FSM.container.className+=" FullScreenMario";FSM.PixelDrawer.setThingArrays([FSM.GroupHolder.getGroup("Scenery"),FSM.GroupHolder.getGroup("Solid"),FSM.GroupHolder.getGroup("Character"),FSM.GroupHolder.getGroup("Text")]);FSM.ItemsHolder.getContainer().style.width=settings.width+"px";FSM.container.appendChild(FSM.ItemsHolder.getContainer());};FullScreenMario.prototype.gameStart=function(){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this);FSM.setMap(FSM.settings.maps.mapDefault,FSM.settings.maps.locationDefault);FSM.ItemsHolder.setItem("lives",FSM.settings.statistics.values.lives.valueDefault);FSM.ModAttacher.fireEvent("onGameStart");};FullScreenMario.prototype.gameOver=function(){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),text=FSM.ObjectMaker.make("CustomText",{"texts":[{"text":"GAME OVER"}]}),texts,textWidth,i;FSM.killNPCs();FSM.AudioPlayer.clearAll();FSM.AudioPlayer.play("Game Over");FSM.GroupHolder.clearArrays();FSM.ItemsHolder.hideContainer();FSM.TimeHandler.cancelAllEvents();FSM.PixelDrawer.setBackground("black");FSM.addThing(text,FSM.MapScreener.width/2,FSM.MapScreener.height/2);texts=text.children;textWidth=-(texts[texts.length-1].right-texts[0].left)/2;for(i=0;i<texts.length;i+=1){FSM.shiftHoriz(texts[i],textWidth);}
FSM.TimeHandler.addEvent(function(){FSM.gameStart();FSM.ItemsHolder.displayContainer();},420);FSM.ModAttacher.fireEvent("onGameOver");};FullScreenMario.prototype.thingProcess=function(thing,title,settings,defaults){if(thing.height==="Infinity"||thing.height===Infinity){thing.height=thing.FSM.getAbsoluteHeight(thing.y)/thing.FSM.unitsize;}
_super.prototype.thingProcess.call(this,thing,title,settings,defaults);thing.FSM.ThingHitter.cacheHitCheckType(thing.title,thing.groupType);};FullScreenMario.prototype.addPreThing=function(prething){var thing=prething.thing,position=prething.position||thing.position;thing.FSM.addThing(thing,prething.left*thing.FSM.unitsize-thing.FSM.MapScreener.left,(thing.FSM.MapScreener.floor-prething.top)*thing.FSM.unitsize);if(position){thing.FSM.TimeHandler.addEvent(function(){switch(position){case "beginning":thing.FSM.arrayToBeginning(thing,thing.FSM.GroupHolder.getGroup(thing.groupType));break;case "end":thing.FSM.arrayToEnd(thing,thing.FSM.GroupHolder.getGroup(thing.groupType));break;default:break;}});}
thing.FSM.ModAttacher.fireEvent("onAddPreThing",prething);};FullScreenMario.prototype.addPlayer=function(left,bottom){if(left===void 0){left=this.unitsize*16;}
if(bottom===void 0){bottom=this.unitsize*16;}
var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),player;player=FSM.player=FSM.ObjectMaker.make("Player",{"power":FSM.ItemsHolder.getItem("power")});player.keys=player.getKeys();if(FSM.MapScreener.underwater){player.swimming=true;FSM.TimeHandler.addClassCycle(player,["swim1","swim2"],"swimming",5);FSM.TimeHandler.addEventInterval(player.FSM.animatePlayerBubbling,96,Infinity,player);}
FSM.setPlayerSizeSmall(player);if(player.power>=2){FSM.playerGetsBig(player,true);if(player.power===3){FSM.playerGetsFire(player);}}
FSM.addThing(player,left,bottom-player.height*FSM.unitsize);FSM.ModAttacher.fireEvent("onAddPlayer",player);return player;};FullScreenMario.prototype.scrollPlayer=function(dx,dy){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this);FSM.scrollThing(FSM.player,dx,dy);FSM.ModAttacher.fireEvent("onScrollPlayer",dx,dy);};FullScreenMario.prototype.onGamePause=function(FSM){FSM.AudioPlayer.pauseAll();FSM.AudioPlayer.play("Pause");FSM.ModAttacher.fireEvent("onGamePause");};FullScreenMario.prototype.onGamePlay=function(FSM){FSM.AudioPlayer.resumeAll();FSM.ModAttacher.fireEvent("onGamePlay");};FullScreenMario.prototype.keyDownLeft=function(FSM,event){if(FSM.GamesRunner.getPaused()){return;}
var player=FSM.player;player.keys.run=-1;player.keys.leftDown=true;player.FSM.ModAttacher.fireEvent("onKeyDownLeft");};FullScreenMario.prototype.keyDownRight=function(FSM,event){if(FSM.GamesRunner.getPaused()){return;}
var player=FSM.player;player.keys.run=1;player.keys.rightDown=true;player.FSM.ModAttacher.fireEvent("onKeyDownRight");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyDownUp=function(FSM,event){if(FSM.GamesRunner.getPaused()){return;}
var player=FSM.player;player.keys.up=true;if(player.canjump&&(player.resting||FSM.MapScreener.underwater)){player.keys.jump=true;player.canjump=false;player.keys.jumplev=0;if(player.power>1){FSM.AudioPlayer.play("Jump Super");}
else{FSM.AudioPlayer.play("Jump Small");}
if(FSM.MapScreener.underwater){FSM.TimeHandler.addEvent(function(){player.jumping=player.keys.jump=false;},14);}}
FSM.ModAttacher.fireEvent("onKeyDownUp");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyDownDown=function(FSM,event){if(FSM.GamesRunner.getPaused()){return;}
var player=FSM.player;player.keys.crouch=true;FSM.ModAttacher.fireEvent("onKeyDownDown");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyDownSprint=function(FSM,event){if(FSM.GamesRunner.getPaused()){return;}
var player=FSM.player;if(player.power===3&&player.keys.sprint===false&&!player.crouching){player.fire(player);}
player.keys.sprint=true;player.FSM.ModAttacher.fireEvent("onKeyDownSprint");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyDownPause=function(FSM,event){if(FSM.GamesRunner.getPaused()){FSM.GamesRunner.play();}
else{FSM.GamesRunner.pause();}
FSM.ModAttacher.fireEvent("onKeyDownPause");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyDownMute=function(FSM,event){if(FSM.GamesRunner.getPaused()){return;}
FSM.AudioPlayer.toggleMuted();FSM.ModAttacher.fireEvent("onKeyDownMute");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyUpLeft=function(FSM,event){var player=FSM.player;player.keys.run=0;player.keys.leftDown=false;FSM.ModAttacher.fireEvent("onKeyUpLeft");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyUpRight=function(FSM,event){var player=FSM.player;player.keys.run=0;player.keys.rightDown=false;FSM.ModAttacher.fireEvent("onKeyUpRight");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyUpUp=function(FSM,event){var player=FSM.player;if(!FSM.MapScreener.underwater){player.keys.jump=player.keys.up=false;}
player.canjump=true;FSM.ModAttacher.fireEvent("onKeyUpUp");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyUpDown=function(FSM,event){var player=FSM.player;player.keys.crouch=false;if(!player.piping){FSM.animatePlayerRemoveCrouch(player);}
FSM.ModAttacher.fireEvent("onKeyUpDown");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyUpSprint=function(FSM,event){var player=FSM.player;player.keys.sprint=false;FSM.ModAttacher.fireEvent("onKeyUpSprint");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.keyUpPause=function(FSM,event){FSM.ModAttacher.fireEvent("onKeyUpPause");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.mouseDownRight=function(FSM,event){FSM.GamesRunner.togglePause();FSM.ModAttacher.fireEvent("onMouseDownRight");if(event&&event.preventDefault!==undefined){event.preventDefault();}};FullScreenMario.prototype.deviceMotion=function(FSM,event){var player=FSM.player,deviceMotionStatus=FSM.deviceMotionStatus,acceleration=event.accelerationIncludingGravity;FSM.ModAttacher.fireEvent("onDeviceMotion",event);if(deviceMotionStatus.y!==undefined){deviceMotionStatus.dy=acceleration.y-deviceMotionStatus.y;if(deviceMotionStatus.dy>0.21){FSM.keyDownUp(FSM);}
else if(deviceMotionStatus.dy<-0.14){FSM.keyUpUp(FSM);}}
deviceMotionStatus.x=acceleration.x;deviceMotionStatus.y=acceleration.y;if(deviceMotionStatus.x>2.1){if(!deviceMotionStatus.motionLeft){player.FSM.keyDownLeft(FSM);deviceMotionStatus.motionLeft=true;}}
else if(deviceMotionStatus.x<-2.1){if(!deviceMotionStatus.motionRight){player.FSM.keyDownRight(FSM);deviceMotionStatus.motionRight=true;}}
else{if(deviceMotionStatus.motionLeft){player.FSM.keyUpLeft(FSM);deviceMotionStatus.motionLeft=false;}
if(deviceMotionStatus.motionRight){player.FSM.keyUpRight(FSM);deviceMotionStatus.motionRight=false;}}};FullScreenMario.prototype.canInputsTrigger=function(FSM){return!FSM.MapScreener.nokeys;};FullScreenMario.prototype.maintainTime=function(FSM){if(!FSM.MapScreener.notime){FSM.ItemsHolder.decrease("time",1);return false;}
if(!FSM.ItemsHolder.getItem("time")){return true;}
return false;};FullScreenMario.prototype.maintainScenery=function(FSM){var things=FSM.GroupHolder.getGroup("Scenery"),delx=FSM.QuadsKeeper.left,thing,i;for(i=0;i<things.length;i+=1){thing=things[i];if(thing.right<delx){FSM.arrayDeleteThing(thing,things,i);i-=1;}}};FullScreenMario.prototype.maintainSolids=function(FSM,solids){var delx=FSM.QuadsKeeper.left,solid,i;FSM.QuadsKeeper.determineAllQuadrants("Solid",solids);for(i=0;i<solids.length;i+=1){solid=solids[i];if(solid.alive&&solid.right>delx){if(solid.movement){solid.movement(solid);}}
else{FSM.arrayDeleteThing(solid,solids,i);i-=1;}}};FullScreenMario.prototype.maintainCharacters=function(FSM,characters){var delx=FSM.QuadsKeeper.right,character,i;for(i=0;i<characters.length;i+=1){character=characters[i];if(character.resting){character.yvel=0;}
else{if(!character.nofall){character.yvel+=character.gravity||FSM.MapScreener.gravity;}
character.yvel=Math.min(character.yvel,FSM.MapScreener.maxyvel);}
character.under=character.undermid=undefined;FSM.updatePosition(character);FSM.QuadsKeeper.determineThingQuadrants(character);FSM.ThingHitter.checkHitsOf[character.title](character);if(character.overlaps&&character.overlaps.length){FSM.maintainOverlaps(character);}
if(character.resting){if(!FSM.isCharacterOnResting(character,character.resting)){if(character.onRestingOff){character.onRestingOff(character,character.resting);}
else{character.resting=undefined;}}
else{character.yvel=0;FSM.setBottom(character,character.resting.top);}}
if(character.alive){if(!character.player&&(character.numquads===0||character.left>delx)&&(!character.outerok||(character.right<FSM.MapScreener.width-delx))){FSM.arrayDeleteThing(character,characters,i);i-=1;}
else{if(!character.nomove&&character.movement){character.movement(character);}}}
else{FSM.arrayDeleteThing(character,characters,i);i-=1;}}};FullScreenMario.prototype.maintainOverlaps=function(character){if(character.checkOverlaps){if(!character.FSM.setOverlapBoundaries(character)){return;}}
character.FSM.slideToX(character,character.overlapGoal,character.FSM.unitsize);if(character.overlapGoRight){if(character.left>=character.overlapCheck){character.FSM.setLeft(character,character.overlapCheck);}
else{return;}}
else{if(character.right<=character.overlapCheck){character.FSM.setRight(character,character.overlapCheck);}
else{return;}}
character.overlaps.length=0;character.checkOverlaps=true;};FullScreenMario.prototype.setOverlapBoundaries=function(thing){if(thing.overlaps.length===1){thing.overlaps.length=0;return false;}
var rightX=-Infinity,leftX=Infinity,overlaps=thing.overlaps,other,leftThing,rightThing,midpoint,i;for(i=0;i<overlaps.length;i+=1){other=overlaps[i];if(other.right>rightX){rightThing=other;}
if(other.left<leftX){leftThing=other;}}
midpoint=(leftX+rightX)/2;if(thing.FSM.getMidX(thing)>=midpoint){thing.overlapGoal=Infinity;thing.overlapGoRight=true;thing.overlapCheck=rightThing.right;}
else{thing.overlapGoal=-Infinity;thing.overlapGoRight=false;thing.overlapCheck=leftThing.left;}
thing.checkOverlaps=false;return true;};FullScreenMario.prototype.maintainPlayer=function(FSM){var player=FSM.player;if(!FSM.isThingAlive(player)){return;}
if(player.yvel>0){if(!FSM.MapScreener.underwater){player.keys.jump=false;}
if(!player.jumping&&!player.crouching){if(FSM.MapScreener.underwater){if(!player.paddling){FSM.switchClass(player,"paddling","paddling");player.paddling=true;}}
else{FSM.addClass(player,"jumping");player.jumping=true;}}
if(!player.dying&&player.top>FSM.MapScreener.bottom){if(FSM.MapsHandler.getArea().exit){FSM.setLocation(FSM.MapsHandler.getArea().exit);}
else{FSM.killPlayer(player,2);}
return;}}
if(player.xvel>0){if(player.right>FSM.MapScreener.middleX){if(player.right>FSM.MapScreener.right-FSM.MapScreener.left){player.xvel=Math.min(0,player.xvel);}}}
else if(player.left<0){player.xvel=Math.max(0,player.xvel);}
if(player.under){player.jumpcount=0;}
if(FSM.MapScreener.canscroll){var scrolloffset=player.right-FSM.MapScreener.middleX;if(scrolloffset>0){FSM.scrollWindow(Math.min(player.scrollspeed,scrolloffset));}}};FullScreenMario.prototype.generateCanThingCollide=function(){return function canThingCollide(thing){return thing.alive&&!thing.nocollide;};};FullScreenMario.prototype.isThingAlive=function(thing){return thing&&thing.alive&&!thing.dead;};FullScreenMario.prototype.isThingTouchingThing=function(thing,other){return(!thing.nocollide&&!other.nocollide&&thing.right-thing.FSM.unitsize>other.left&&thing.left+thing.FSM.unitsize<other.right&&thing.bottom>=other.top&&thing.top<=other.bottom);};FullScreenMario.prototype.isThingOnThing=function(thing,other){if(thing.groupType==="Solid"&&other.yvel>0){return false;}
if(thing.yvel<other.yvel&&other.groupType!=="Solid"){return false;}
if(thing.player&&thing.bottom<other.bottom&&other.type==="enemy"){return true;}
if(thing.left+thing.FSM.unitsize>=other.right){return false;}
if(thing.right-thing.FSM.unitsize<=other.left){return false;}
if(thing.bottom<=other.top+other.toly+other.yvel){return true;}
if(thing.bottom<=other.top+other.toly+Math.abs(thing.yvel-other.yvel)){return true;}
return false;};FullScreenMario.prototype.isThingOnSolid=function(thing,other){if(thing.left+thing.FSM.unitsize>=other.right){return false;}
if(thing.right-thing.FSM.unitsize<=other.left){return false;}
if(thing.bottom-thing.yvel<=other.top+other.toly+thing.yvel){return true;}
if(thing.bottom<=other.top+other.toly+Math.abs(thing.yvel-other.yvel)){return true;}
return false;};FullScreenMario.prototype.isCharacterOnSolid=function(thing,other){if(thing.resting===other){return true;}
if(thing.yvel<0){return false;}
if(!thing.FSM.isThingOnSolid(thing,other)){return false;}
if(thing.left+thing.xvel+thing.FSM.unitsize===other.right){return false;}
if(thing.right-thing.xvel-thing.FSM.unitsize===other.left){return false;}
return true;};FullScreenMario.prototype.isCharacterOnResting=function(thing,other){if(!thing.FSM.isThingOnSolid(thing,other)){return false;}
if(thing.left+thing.xvel+thing.FSM.unitsize===other.right){return false;}
if(thing.right-thing.xvel-thing.FSM.unitsize===other.left){return false;}
return true;};FullScreenMario.prototype.generateIsCharacterTouchingCharacter=function(){return function isCharacterTouchingCharacter(thing,other){if(thing.nocollidechar&&(!other.player||thing.nocollideplayer)){return false;}
if(other.nocollidechar&&(!thing.player||other.nocollideplayer)){return false;}
return thing.FSM.isThingTouchingThing(thing,other);};};FullScreenMario.prototype.generateIsCharacterTouchingSolid=function(){return function isCharacterTouchingSolid(thing,other){if(other.hidden&&!other.collideHidden){if(!thing.player||!thing.FSM.isSolidOnCharacter(other,thing)){return false;}}
if(thing.nocollidesolid&&!(thing.allowUpSolids&&other.up)){return false;}
return thing.FSM.isThingTouchingThing(thing,other);};};FullScreenMario.prototype.isCharacterAboveEnemy=function(thing,other){return thing.bottom<other.top+other.toly;};FullScreenMario.prototype.isCharacterBumpingSolid=function(thing,other){return thing.top+thing.toly+Math.abs(thing.yvel)>other.bottom;};FullScreenMario.prototype.isCharacterOverlappingSolid=function(thing,other){return thing.top<=other.top&&thing.bottom>other.bottom;};FullScreenMario.prototype.isSolidOnCharacter=function(thing,other){if(other.yvel>=0){return false;}
var midx=thing.FSM.getMidX(other);if(midx<=thing.left||midx>=thing.right){return false;}
if(thing.bottom-thing.yvel>other.top+other.toly-other.yvel){return false;}
return true;};FullScreenMario.prototype.gainLife=function(amount,nosound){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this);amount=Number(amount)||1;FSM.ItemsHolder.increase("lives",amount);if(!nosound){this.AudioPlayer.play("Gain Life");}
FSM.ModAttacher.fireEvent("onGainLife",amount);};FullScreenMario.prototype.itemJump=function(thing){thing.yvel-=FullScreenMario.unitsize*1.4;this.shiftVert(thing,-FullScreenMario.unitsize);};FullScreenMario.prototype.jumpEnemy=function(thing,other){if(thing.keys.up){thing.yvel=thing.FSM.unitsize*-1.4;}
else{thing.yvel=thing.FSM.unitsize*-0.7;}
thing.xvel*=0.91;thing.FSM.AudioPlayer.play("Kick");if(other.group!=="item"||other.shell){thing.jumpcount+=1;thing.FSM.scoreOn(thing.FSM.findScore(thing.jumpcount+thing.jumpers),other);}
thing.jumpers+=1;thing.FSM.TimeHandler.addEvent(function(thing){thing.jumpers-=1;},1,thing);};FullScreenMario.prototype.playerShroom=function(thing,other){if(thing.shrooming||!thing.player){return;}
thing.FSM.AudioPlayer.play("Powerup");thing.FSM.scoreOn(1000,thing.FSM.player);if(thing.power<3){thing.FSM.ItemsHolder.increase("power");if(thing.power<3){thing.shrooming=true;thing.power+=1;if(thing.power===3){thing.FSM.playerGetsFire(thing.FSM.player);}
else{thing.FSM.playerGetsBig(thing.FSM.player);}}}
thing.FSM.ModAttacher.fireEvent("onPlayerShroom",thing,other);};FullScreenMario.prototype.playerShroom1Up=function(thing,other){if(!thing.player){return;}
thing.FSM.gainLife(1);thing.FSM.ModAttacher.fireEvent("onPlayerShroom1Up",thing,other);};FullScreenMario.prototype.playerStarUp=function(thing,timeout){if(timeout===void 0){timeout=560;}
thing.star+=1;thing.FSM.switchClass(thing,"normal fiery","star");thing.FSM.AudioPlayer.play("Powerup");thing.FSM.AudioPlayer.addEventListener("Powerup","ended",thing.FSM.AudioPlayer.playTheme.bind(thing.FSM.AudioPlayer,"Star",true));thing.FSM.TimeHandler.addClassCycle(thing,["star1","star2","star3","star4"],"star",2);thing.FSM.TimeHandler.addEvent(thing.FSM.playerStarDown,timeout||560,thing);thing.FSM.ModAttacher.fireEvent("onPlayerStarUp",thing);};FullScreenMario.prototype.playerStarDown=function(thing){if(!thing.player){return;}
thing.FSM.TimeHandler.cancelClassCycle(thing,"star");thing.FSM.TimeHandler.addClassCycle(thing,["star1","star2","star3","star4"],"star",5);thing.FSM.TimeHandler.addEvent(thing.FSM.playerStarOffCycle,140,thing);thing.FSM.AudioPlayer.removeEventListeners("Powerup","ended");thing.FSM.ModAttacher.fireEvent("onPlayerStarDown",thing);};FullScreenMario.prototype.playerStarOffCycle=function(thing){if(!thing.player){return;}
if(thing.star>1){thing.star-=1;return;}
if(!thing.FSM.AudioPlayer.getTheme().paused){thing.FSM.AudioPlayer.playTheme();}
thing.FSM.TimeHandler.addEvent(thing.FSM.playerStarOffFinal,70,thing);thing.FSM.ModAttacher.fireEvent("onPlayerStarOffCycle",thing);};FullScreenMario.prototype.playerStarOffFinal=function(thing){if(!thing.player){return;}
thing.star-=1;thing.FSM.TimeHandler.cancelClassCycle(thing,"star");thing.FSM.removeClasses(thing,"star star1 star2 star3 star4");thing.FSM.addClass(thing,"normal");if(thing.power===3){thing.FSM.addClass(thing,"fiery");}
thing.FSM.ModAttacher.fireEvent("onPlayerStarOffFinal",thing);};FullScreenMario.prototype.playerGetsBig=function(thing,noAnimation){thing.FSM.setPlayerSizeLarge(thing);thing.FSM.removeClasses(thing,"crouching small");thing.FSM.updateBottom(thing,0);thing.FSM.updateSize(thing);if(noAnimation){thing.FSM.addClass(thing,"large");}
else{thing.FSM.playerGetsBigAnimation(thing);}
thing.FSM.ModAttacher.fireEvent("onPlayerGetsBig",thing);};FullScreenMario.prototype.playerGetsBigAnimation=function(thing){var stages=["shrooming1","shrooming2","shrooming1","shrooming2","shrooming3","shrooming2","shrooming3"];thing.FSM.addClass(thing,"shrooming");thing.FSM.thingPauseVelocity(thing);stages.push(function(thing,stages){thing.shrooming=false;stages.length=0;thing.FSM.addClass(thing,"large");thing.FSM.removeClasses(thing,"shrooming shrooming3");thing.FSM.thingResumeVelocity(thing);return true;});thing.FSM.TimeHandler.addClassCycle(thing,stages,"shrooming",6);};FullScreenMario.prototype.playerGetsSmall=function(thing){var bottom=thing.bottom;thing.FSM.thingPauseVelocity(thing);thing.nocollidechar=true;thing.FSM.animateFlicker(thing);thing.FSM.removeClasses(thing,"running skidding jumping fiery");thing.FSM.addClasses(thing,"paddling small");thing.FSM.TimeHandler.addEvent(function(thing){thing.FSM.removeClass(thing,"large");thing.FSM.setPlayerSizeSmall(thing);thing.FSM.setBottom(thing,bottom-FullScreenMario.unitsize);},21,thing);thing.FSM.TimeHandler.addEvent(function(thing){thing.FSM.thingResumeVelocity(thing,false);thing.FSM.removeClass(thing,"paddling");if(thing.running||thing.xvel){thing.FSM.addClass(thing,"running");}
thing.FSM.PixelDrawer.setThingSprite(thing);},42,thing);thing.FSM.TimeHandler.addEvent(function(thing){thing.nocollidechar=false;},70,thing);thing.FSM.ModAttacher.fireEvent("onPlayerGetsSmall");};FullScreenMario.prototype.playerGetsFire=function(thing){thing.shrooming=false;if(!thing.star){thing.FSM.addClass(thing,"fiery");}
thing.FSM.ModAttacher.fireEvent("onPlayerGetsFire");};FullScreenMario.prototype.setPlayerSizeSmall=function(thing){thing.FSM.setSize(thing,8,8,true);thing.FSM.updateSize(thing);};FullScreenMario.prototype.setPlayerSizeLarge=function(thing){thing.FSM.setSize(thing,8,16,true);thing.FSM.updateSize(thing);};FullScreenMario.prototype.animatePlayerRemoveCrouch=function(thing){thing.crouching=false;thing.toly=thing.tolyOld||0;if(thing.power!==1){thing.FSM.setHeight(thing,16,true,true);thing.FSM.removeClasses(thing,"crouching");thing.FSM.updateBottom(thing,0);thing.FSM.updateSize(thing);}
thing.FSM.animatePlayerRunningCycle(thing);};FullScreenMario.prototype.unattachPlayer=function(thing,other){thing.nofall=false;thing.nocollide=false;thing.checkOverlaps=true;thing.attachedSolid=undefined;thing.xvel=thing.keys?thing.keys.run:0;thing.movement=thing.FSM.movePlayer;thing.FSM.addClass(thing,"jumping");thing.FSM.removeClasses(thing,"climbing","animated");other.attachedCharacter=undefined;};FullScreenMario.prototype.playerAddRestingStone=function(thing){var stone=thing.FSM.addThing("RestingStone",thing.left,thing.top+thing.FSM.unitsize*48);thing.nocollide=true;thing.FSM.TimeHandler.addEventInterval(function(){if(thing.bottom<stone.top){return false;}
thing.nocollide=false;thing.FSM.setMidXObj(stone,thing);thing.FSM.setBottom(thing,stone.top);return true;},1,Infinity);};FullScreenMario.prototype.markOverlap=function(thing,other){if(!thing.overlaps){thing.overlaps=[other];}
else{thing.overlaps.push(other);}};FullScreenMario.prototype.spawnDeadGoomba=function(thing){thing.FSM.TimeHandler.addEvent(FullScreenMario.prototype.killNormal,21,thing);};FullScreenMario.prototype.spawnHammerBro=function(thing){thing.counter=0;thing.gravity=thing.FSM.MapScreener.gravity/2.1;thing.FSM.TimeHandler.addEvent(thing.FSM.animateThrowingHammer,35,thing,7);thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateJump,140,Infinity,thing);};FullScreenMario.prototype.spawnBowser=function(thing){var i;thing.counter=0;thing.deathcount=0;for(i=0;i<thing.fireTimes.length;i+=1){thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateBowserFire,thing.fireTimes[i],Infinity,thing);}
for(i=0;i<thing.jumpTimes.length;i+=1){thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateBowserJump,thing.jumpTimes[i],Infinity,thing);}
if(thing.throwing){for(i=0;i<thing.throwAmount;i+=1){thing.FSM.TimeHandler.addEvent(function(){thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateBowserThrow,thing.throwPeriod,Infinity,thing);},thing.throwDelay+i*thing.throwBetween);}}};FullScreenMario.prototype.spawnPiranha=function(thing){var bottom;thing.counter=0;thing.direction=thing.FSM.unitsize/-40;if(thing.onPipe){bottom=thing.bottom;thing.FSM.setHeight(thing,6);thing.FSM.setBottom(thing,bottom);}};FullScreenMario.prototype.spawnBlooper=function(thing){thing.squeeze=0;thing.counter=0;};FullScreenMario.prototype.spawnPodoboo=function(thing){thing.FSM.TimeHandler.addEventInterval(thing.FSM.animatePodobooJumpUp,thing.frequency,Infinity,thing);};FullScreenMario.prototype.spawnLakitu=function(thing){thing.FSM.MapScreener.lakitu=thing;thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateLakituThrowingSpiny,140,Infinity,thing);};FullScreenMario.prototype.spawnCannon=function(thing){if(thing.noBullets){return;}
thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateCannonFiring,thing.frequency,thing.frequency,thing);};FullScreenMario.prototype.spawnCastleBlock=function(thing){if(!thing.fireballs){return;}
var balls=[],i;for(i=0;i<thing.fireballs;i+=1){balls.push(thing.FSM.addThing("CastleFireball"));thing.FSM.setMidObj(balls[i],thing);}
if(thing.speed>=0){thing.dt=0.07;thing.angle=0.25;}
else{thing.dt=-0.07;thing.angle=-0.25;}
if(!thing.direction){thing.direction=-1;}
thing.FSM.TimeHandler.addEventInterval(thing.FSM.animateCastleBlock,Math.round(7/Math.abs(thing.speed)),Infinity,thing,balls);};FullScreenMario.prototype.spawnMoveFloating=function(thing){thing.FSM.setMovementEndpoints(thing);thing.begin=(thing.FSM.MapScreener.floor*thing.FSM.unitsize-thing.begin);thing.end=(thing.FSM.MapScreener.floor*thing.FSM.unitsize-thing.end);};FullScreenMario.prototype.spawnMoveSliding=function(thing){thing.FSM.setMovementEndpoints(thing);};FullScreenMario.prototype.spawnScalePlatform=function(thing){var collection=thing.collection,ownKey=thing.collectionKey==="platformLeft"?"Left":"Right",partnerKey=ownKey==="Left"?"Right":"Left";thing.partners={"ownString":collection["string"+ownKey],"partnerString":collection["string"+partnerKey],"partnerPlatform":collection["platform"+partnerKey]};};FullScreenMario.prototype.spawnRandomCheep=function(FSM){if(!FSM.MapScreener.spawningCheeps){return true;}
var spawn;spawn=FSM.ObjectMaker.make("CheepCheep",{"flying":true,"xvel":FSM.NumberMaker.random()*FSM.unitsize*1.4,"yvel":FSM.unitsize*-1.4});FSM.addThing(spawn,FSM.NumberMaker.random()*FSM.MapScreener.width,FSM.MapScreener.height);if(spawn.left<FSM.MapScreener.width/2){FSM.flipHoriz(spawn);}
else{spawn.xvel*=-1;}
return false;};FullScreenMario.prototype.spawnRandomBulletBill=function(FSM){if(!FSM.MapScreener.spawningBulletBills){return true;}
var spawn;spawn=FSM.ObjectMaker.make("BulletBill");spawn.direction=1;spawn.moveleft=true;spawn.xvel*=-1;FSM.flipHoriz(spawn);FSM.addThing(spawn,FSM.MapScreener.width,Math.floor(FSM.NumberMaker.randomIntWithin(0,FSM.MapScreener.floor)/8)*8*FSM.unitsize);return false;};FullScreenMario.prototype.spawnCustomText=function(thing){var top=thing.top,texts=thing.texts,attributes=thing.textAttributes,spacingHorizontal=thing.spacingHorizontal*thing.FSM.unitsize,spacingVertical=thing.spacingVertical*thing.FSM.unitsize,spacingVerticalBlank=thing.spacingVerticalBlank*thing.FSM.unitsize,children=[],left,text,letter,textThing,i,j;thing.children=children;for(i=0;i<texts.length;i+=1){if(!texts[i]){top+=spacingVerticalBlank;continue;}
text=texts[i].text;if(texts[i].offset){left=thing.left+texts[i].offset*thing.FSM.unitsize;}
else{left=thing.left;}
for(j=0;j<text.length;j+=1){letter=text[j];if(thing.FSM.customTextMappings.hasOwnProperty(letter)){letter=thing.FSM.customTextMappings[letter];}
letter="Text"+thing.size+letter;textThing=thing.FSM.ObjectMaker.make(letter,attributes);textThing.FSM.addThing(textThing,left,top);children.push(textThing);left+=textThing.width*thing.FSM.unitsize;left+=spacingHorizontal;}
top+=spacingVertical;}
thing.FSM.killNormal(thing);};FullScreenMario.prototype.spawnDetector=function(thing){thing.activate(thing);thing.FSM.killNormal(thing);};FullScreenMario.prototype.spawnScrollBlocker=function(thing){if(thing.FSM.MapScreener.width<thing.right){thing.setEdge=true;}};FullScreenMario.prototype.spawnCollectionComponent=function(collection,thing){thing.collection=collection;collection[thing.collectionName]=thing;};FullScreenMario.prototype.spawnCollectionPartner=function(collection,thing){var partnerNames=thing.collectionPartnerNames,partners={},name;for(name in partnerNames){if(partnerNames.hasOwnProperty(name)){partners[name]=collection[partnerNames[name]];}}
thing.partners={};};FullScreenMario.prototype.spawnRandomSpawner=function(thing){var FSM=thing.FSM,left=(thing.left+FSM.MapScreener.left)/FSM.unitsize;FSM.WorldSeeder.clearGeneratedCommands();FSM.WorldSeeder.generateFull({"title":thing.randomization,"top":thing.randomTop,"right":left+thing.randomWidth,"bottom":thing.randomBottom,"left":left,"width":thing.randomWidth,"height":thing.randomTop-thing.randomBottom});FSM.WorldSeeder.runGeneratedCommands();FSM.MapsHandler.spawnMap("xInc",FSM.QuadsKeeper.top/FSM.unitsize,FSM.QuadsKeeper.right/FSM.unitsize,FSM.QuadsKeeper.bottom/FSM.unitsize,FSM.QuadsKeeper.left/FSM.unitsize);};FullScreenMario.prototype.activateCheepsStart=function(thing){thing.FSM.MapScreener.spawningCheeps=true;thing.FSM.TimeHandler.addEventInterval(thing.FSM.spawnRandomCheep,21,Infinity,thing.FSM);};FullScreenMario.prototype.activateCheepsStop=function(thing){thing.FSM.MapScreener.spawningCheeps=false;};FullScreenMario.prototype.activateBulletBillsStart=function(thing){thing.FSM.MapScreener.spawningBulletBills=true;thing.FSM.TimeHandler.addEventInterval(thing.FSM.spawnRandomBulletBill,210,Infinity,thing.FSM);};FullScreenMario.prototype.activateBulletBillsStop=function(thing){thing.FSM.MapScreener.spawningBulletBills=false;};FullScreenMario.prototype.activateLakituStop=function(thing){var lakitu=thing.FSM.MapScreener.lakitu;if(!lakitu){return;}
lakitu.fleeing=true;lakitu.movement=thing.FSM.moveLakituFleeing;};FullScreenMario.prototype.activateWarpWorld=function(thing,other){var collection=other.collection,key=0,keyString,texts,j;if(!thing.player){return;}
texts=collection.Welcomer.children;for(j=0;j<texts.length;j+=1){if(texts[j].title!=="TextSpace"){texts[j].hidden=false;}}
while(true){keyString=key+"-Text";if(!collection.hasOwnProperty(keyString)){break;}
texts=collection[keyString].children;for(j=0;j<texts.length;j+=1){if(texts[j].title!=="TextSpace"){texts[j].hidden=false;}}
thing.FSM.killNormal(collection[key+"-Piranha"]);key+=1;}};FullScreenMario.prototype.activateRestingStone=function(thing,other){if(thing.activated){return;}
thing.activated=true;thing.opacity=1;thing.FSM.AudioPlayer.playTheme();thing.FSM.TimeHandler.addEventInterval(function(){if(other.resting===thing){return false;}
thing.FSM.killNormal(thing);return true;},1,Infinity);};FullScreenMario.prototype.activateWindowDetector=function(thing){if(thing.FSM.MapScreener.right-thing.FSM.MapScreener.left<thing.left){return;}
thing.activate(thing);thing.FSM.killNormal(thing);};FullScreenMario.prototype.activateScrollBlocker=function(thing){var dx=thing.FSM.MapScreener.width-thing.left;thing.FSM.MapScreener.canscroll=false;if(thing.setEdge&&dx>0){thing.FSM.scrollWindow(-dx);}};FullScreenMario.prototype.activateScrollEnabler=function(thing){thing.FSM.MapScreener.canscroll=true;};FullScreenMario.prototype.activateSectionBefore=function(thing){var FSM=thing.FSM,MapsCreator=FSM.MapsCreator,MapScreener=FSM.MapScreener,MapsHandler=FSM.MapsHandler,area=MapsHandler.getArea(),map=MapsHandler.getMap(),prethings=MapsHandler.getPreThings(),section=area.sections[thing.section||0],left=(thing.left+MapScreener.left)/FSM.unitsize,before=section.before?section.before.creation:undefined,command,i;if(before){for(i=0;i<before.length;i+=1){command=FSM.proliferate({},before[i]);if(!command.x){command.x=left;}
else{command.x+=left;}
if(command.sliding){command.begin+=left;command.end+=left;}
MapsCreator.analyzePreSwitch(command,prethings,area,map);}}
command={"thing":"DetectWindow","x":left+(before?section.before.width:0),"y":0,"activate":FSM.activateSectionStretch,"section":thing.section||0};MapsCreator.analyzePreSwitch(command,prethings,area,map);MapsHandler.spawnMap("xInc",MapScreener.top/FSM.unitsize,(MapScreener.left+FSM.QuadsKeeper.right)/FSM.unitsize,MapScreener.bottom/FSM.unitsize,left);};FullScreenMario.prototype.activateSectionStretch=function(thing){var FSM=thing.FSM,MapsCreator=FSM.MapsCreator,MapScreener=FSM.MapScreener,MapsHandler=FSM.MapsHandler,area=MapsHandler.getArea(),map=MapsHandler.getMap(),prethings=MapsHandler.getPreThings(),section=area.sections[thing.section||0],stretch=section.stretch?section.stretch.creation:undefined,left=(thing.left+MapScreener.left)/FSM.unitsize,width=MapScreener.width/FSM.unitsize,command,i;if(stretch){for(i=0;i<stretch.length;i+=1){command=FSM.proliferate({},stretch[i]);command.x=left;command.width=width;MapsCreator.analyzePreSwitch(command,prethings,area,map);}
command={"thing":"DetectWindow","x":left+width,"y":0,"activate":FSM.activateSectionAfter,"section":thing.section||0};MapsCreator.analyzePreSwitch(command,prethings,area,map);}
MapsHandler.spawnMap("xInc",MapScreener.top/FSM.unitsize,left+(MapScreener.width/FSM.unitsize),MapScreener.bottom/FSM.unitsize,left);};FullScreenMario.prototype.activateSectionAfter=function(thing){var FSM=thing.FSM,MapsCreator=FSM.MapsCreator,MapScreener=FSM.MapScreener,MapsHandler=FSM.MapsHandler,area=MapsHandler.getArea(),map=MapsHandler.getMap(),prethings=MapsHandler.getPreThings(),section=area.sections[thing.section||0],left=(thing.left+MapScreener.left)/FSM.unitsize,after=section.after?section.after.creation:undefined,command,i;if(after){for(i=0;i<after.length;i+=1){command=FSM.proliferate({},after[i]);if(!command.x){command.x=left;}
else{command.x+=left;}
if(command.sliding){command.begin+=left;command.end+=left;}
MapsCreator.analyzePreSwitch(command,prethings,area,map);}}
MapsHandler.spawnMap("xInc",MapScreener.top/FSM.unitsize,left+(MapScreener.right/FSM.unitsize),MapScreener.bottom/FSM.unitsize,left);};FullScreenMario.prototype.generateHitCharacterSolid=function(){return function hitCharacterSolid(thing,other){if(other.up&&thing!==other.up){return thing.FSM.collideCharacterSolidUp(thing,other);}
other.collide(thing,other);if(thing.undermid){if(thing.undermid.bottomBump){thing.undermid.bottomBump(thing.undermid,thing);}}
else if(thing.under&&thing.under&&thing.under.bottomBump){thing.under.bottomBump(thing.under[0],thing);}
if(thing.checkOverlaps&&thing.FSM.isCharacterOverlappingSolid(thing,other)){thing.FSM.markOverlap(thing,other);}};};FullScreenMario.prototype.generateHitCharacterCharacter=function(){return function hitCharacterCharacter(thing,other){if(thing.player){if(other.collide){return other.collide(thing,other);}}
else if(thing.collide){thing.collide(other,thing);}};};FullScreenMario.prototype.collideFriendly=function(thing,other){if(!thing.player||!thing.FSM.isThingAlive(other)){return;}
if(other.action){other.action(thing,other);}
other.death(other);};FullScreenMario.prototype.collideCharacterSolid=function(thing,other){if(other.up===thing){return;}
if(thing.FSM.isCharacterOnSolid(thing,other)){if(other.hidden&&!other.collideHidden){return;}
if(thing.resting!==other){thing.resting=other;if(thing.onResting){thing.onResting(thing,other);}
if(other.onRestedUpon){other.onRestedUpon(other,thing);}}}
else if(thing.FSM.isSolidOnCharacter(other,thing)){var midx=thing.FSM.getMidX(thing);if(midx>other.left&&midx<other.right){thing.undermid=other;}
else if(other.hidden&&!other.collideHidden){return;}
if(!thing.under){thing.under=[other];}
else{thing.under.push(other);}
if(thing.player){thing.keys.jump=false;thing.FSM.setTop(thing,other.bottom-thing.toly+other.yvel);}
thing.yvel=other.yvel;}
if(other.hidden&&!other.collideHidden){return;}
if(thing.resting!==other&&!thing.FSM.isCharacterBumpingSolid(thing,other)&&!thing.FSM.isThingOnThing(thing,other)&&!thing.FSM.isThingOnThing(other,thing)&&!thing.under){if(thing.right<=other.right){thing.xvel=Math.min(thing.xvel,0);thing.FSM.shiftHoriz(thing,Math.max(other.left+thing.FSM.unitsize-thing.right,thing.FSM.unitsize/-2));}
else{thing.xvel=Math.max(thing.xvel,0);thing.FSM.shiftHoriz(thing,Math.min(other.right-thing.FSM.unitsize-thing.left,thing.FSM.unitsize/2));}
if(!thing.player){if(!thing.noflip){thing.moveleft=!thing.moveleft;}
if(thing.group==="item"){thing.collide(other,thing);}}
else if(other.actionLeft){thing.FSM.ModAttacher.fireEvent("onPlayerActionLeft",thing,other);other.actionLeft(thing,other,other.transport);}}};FullScreenMario.prototype.collideCharacterSolidUp=function(thing,other){if(thing.onCollideUp){thing.onCollideUp(thing,other);}
else{thing.FSM.scoreOn(thing.scoreBelow,thing);thing.death(thing,2);}};FullScreenMario.prototype.collideUpItem=function(thing,other){thing.FSM.animateCharacterHop(thing);thing.moveleft=thing.FSM.objectToLeft(thing,other);};FullScreenMario.prototype.collideUpCoin=function(thing,other){thing.blockparent=other;thing.animate(thing,other);};FullScreenMario.prototype.collideCoin=function(thing,other){if(!thing.player){return;}
thing.FSM.AudioPlayer.play("Coin");thing.FSM.ItemsHolder.increase("score",200);thing.FSM.ItemsHolder.increase("coins",1);thing.FSM.killNormal(other);};FullScreenMario.prototype.collideStar=function(thing,other){if(!thing.player||thing.star){return;}
thing.FSM.playerStarUp(thing);thing.FSM.ModAttacher.fireEvent("onCollideStar",thing,other);};FullScreenMario.prototype.collideFireball=function(thing,other){if(!thing.FSM.isThingAlive(thing)||thing.height<thing.FSM.unitsize){return;}
if(thing.nofire){if(thing.nofire>1){other.death(other);}
return;}
if(thing.nofiredeath){thing.FSM.AudioPlayer.playLocal("Bump",thing.FSM.getMidX(other));thing.death(thing);}
else{thing.FSM.AudioPlayer.playLocal("Kick",thing.FSM.getMidX(other));thing.death(thing,2);thing.FSM.scoreOn(thing.scoreFire,thing);}
other.death(other);};FullScreenMario.prototype.collideCastleFireball=function(thing,other){if(thing.star){other.death(other);}
else{thing.death(thing);}};FullScreenMario.prototype.collideShell=function(thing,other){if(thing.shell){if(other.shell){return thing.FSM.collideShellShell(thing,other);}
return thing.FSM.collideShell(thing,other);}
if(thing.groupType==="Solid"){return thing.FSM.collideShellSolid(thing,other);}
if(thing.player){return thing.FSM.collideShellPlayer(thing,other);}
if(other.xvel){thing.FSM.killFlip(thing);if(thing.shellspawn){thing=thing.FSM.killSpawn(thing);}
thing.FSM.AudioPlayer.play("Kick");thing.FSM.scoreOn(thing.FSM.findScore(other.enemyhitcount),thing);other.enemyhitcount+=1;}
else{thing.moveleft=thing.FSM.objectToLeft(thing,other);}};FullScreenMario.prototype.collideShellSolid=function(thing,other){if(other.right<thing.right){thing.FSM.AudioPlayer.playLocal("Bump",thing.left);thing.FSM.setRight(other,thing.left);other.xvel=-other.speed;other.moveleft=true;}
else{thing.FSM.AudioPlayer.playLocal("Bump",thing.right);thing.FSM.setLeft(other,thing.right);other.xvel=other.speed;other.moveleft=false;}};FullScreenMario.prototype.collideShellPlayer=function(thing,other){var shelltoleft=thing.FSM.objectToLeft(other,thing),playerjump=thing.yvel>0&&(thing.bottom<=other.top+thing.FSM.unitsize*2);if(thing.star){thing.FSM.scorePlayerShell(thing,other);other.death(other,2);return;}
if(other.landing){if(other.shelltoleft===shelltoleft){other.landing+=1;if(other.landing===1){thing.FSM.scorePlayerShell(thing,other);}
thing.FSM.TimeHandler.addEvent(function(other){other.landing-=1;},2,other);}
else{thing.death(thing);}
return;}
if(other.xvel===0||playerjump){other.counting=0;if(other.xvel===0){thing.FSM.AudioPlayer.play("Kick");thing.FSM.scorePlayerShell(thing,other);if(shelltoleft){other.moveleft=true;other.xvel=-other.speed;}
else{other.moveleft=false;other.xvel=other.speed;}
other.hitcount+=1;thing.FSM.TimeHandler.addEvent(function(other){other.hitcount-=1;},2,other);}
else{other.xvel=0;}
if(other.peeking){other.peeking=0;thing.FSM.removeClass(other,"peeking");other.height-=thing.FSM.unitsize/8;thing.FSM.updateSize(other);}
if(playerjump){thing.FSM.AudioPlayer.play("Kick");if(!other.xvel){thing.FSM.jumpEnemy(thing,other);thing.yvel*=2;thing.FSM.setBottom(thing,other.top-thing.FSM.unitsize);}
else{}
other.landing+=1;other.shelltoleft=shelltoleft;thing.FSM.TimeHandler.addEvent(function(other){other.landing-=1;},2,other);}}
else{if(!other.hitcount&&((shelltoleft&&other.xvel>0)||(!shelltoleft&&other.xvel<0))){thing.death(thing);}}};FullScreenMario.prototype.collideShellShell=function(thing,other){if(thing.xvel!==0){if(other.xvel!==0){var temp=thing.xvel;thing.xvel=other.xvel;other.xvel=temp;thing.FSM.shiftHoriz(thing,thing.xvel);thing.FSM.shiftHoriz(other,other.xvel);}
else{thing.FSM.ItemsHolder.increase("score",500);other.death(other);}}
else{thing.FSM.ItemsHolder.increase("score",500);thing.death(thing);}};FullScreenMario.prototype.collideEnemy=function(thing,other){if(!thing.player&&other.player){return thing.FSM.collideEnemy(thing,other);}
if(!thing.FSM.isThingAlive(thing)||!thing.FSM.isThingAlive(other)){return;}
if(thing.group==="item"){if(thing.collidePrimary){return thing.collide(other,thing);}
return;}
if(!thing.player){thing.moveleft=thing.FSM.objectToLeft(thing,other);other.moveleft=!thing.moveleft;return;}
if((thing.star&&!other.nostar)||(!thing.FSM.MapScreener.underwater&&(!other.deadly&&thing.FSM.isThingOnThing(thing,other)))){var player=thing;if(player.FSM.isCharacterAboveEnemy(player,other)){return;}
if(player.star){other.nocollide=true;other.death(other,2);player.FSM.scoreOn(other.scoreStar,other);player.FSM.AudioPlayer.play("Kick");}
else{player.FSM.setBottom(player,Math.min(player.bottom,other.top+player.FSM.unitsize));player.FSM.TimeHandler.addEvent(player.FSM.jumpEnemy,0,player,other);other.death(other,player.star?2:0);player.FSM.addClass(player,"hopping");player.FSM.removeClasses(player,"running skidding jumping one two three");player.hopping=true;if(player.power===1){player.FSM.setPlayerSizeSmall(player);}}}
else if(!thing.FSM.isCharacterAboveEnemy(thing,other)){thing.death(thing);}};FullScreenMario.prototype.collideBottomBrick=function(thing,other){if(other.solid&&!thing.solid){return thing.FSM.collideBottomBrick(other,thing);}
if(thing.up||!other.player){return;}
thing.FSM.AudioPlayer.play("Bump");if(thing.used){return;}
thing.up=other;if(other.power>1&&thing.breakable&&!thing.contents){thing.FSM.TimeHandler.addEvent(thing.FSM.killBrick,2,thing,other);return;}
thing.FSM.animateSolidBump(thing);if(thing.contents){thing.FSM.TimeHandler.addEvent(function(){thing.FSM.animateSolidContents(thing,other);if(thing.contents!=="Coin"){thing.FSM.animateBlockBecomesUsed(thing);}
else{if(thing.lastcoin){thing.FSM.animateBlockBecomesUsed(thing);}
else{thing.FSM.TimeHandler.addEvent(function(){thing.lastcoin=true;},245);}}},7);}};FullScreenMario.prototype.collideBottomBlock=function(thing,other){if(other.solid&&!thing.solid){return thing.FSM.collideBottomBlock(other,thing);}
if(thing.up||!other.player){return;}
if(thing.used){thing.FSM.AudioPlayer.play("Bump");return;}
thing.used=true;thing.hidden=false;thing.up=other;thing.FSM.animateSolidBump(thing);thing.FSM.removeClass(thing,"hidden");thing.FSM.switchClass(thing,"unused","used");thing.FSM.TimeHandler.addEvent(thing.FSM.animateSolidContents,7,thing,other);};FullScreenMario.prototype.collideVine=function(thing,other){if(!thing.player||thing.attachedSolid||thing.climbing){return;}
if(thing.bottom>other.bottom+thing.FSM.unitsize*2){return;}
other.attachedCharacter=thing;thing.attachedSolid=other;thing.nofall=true;thing.checkOverlaps=false;thing.resting=undefined;if(thing.right<other.right){thing.lookleft=false;thing.moveleft=false;thing.attachedDirection=-1;thing.FSM.unflipHoriz(thing);}
else{thing.lookleft=true;thing.moveleft=true;thing.attachedDirection=1;thing.FSM.flipHoriz(thing);}
thing.FSM.thingPauseVelocity(thing);thing.FSM.addClass(thing,"climbing");thing.FSM.removeClasses(thing,"running","jumping","skidding");thing.FSM.TimeHandler.cancelClassCycle(thing,"running");thing.FSM.TimeHandler.addClassCycle(thing,["one","two"],"climbing",0);thing.attachedLeft=!thing.FSM.objectToLeft(thing,other);thing.attachedOff=thing.attachedLeft?1:-1;thing.movement=thing.FSM.movePlayerVine;};FullScreenMario.prototype.collideSpringboard=function(thing,other){if(thing.player&&thing.yvel>=0&&!other.tension&&thing.FSM.isCharacterOnSolid(thing,other)){other.tension=other.tensionSave=Math.max(thing.yvel*0.77,thing.FSM.unitsize);thing.movement=thing.FSM.movePlayerSpringboardDown;thing.spring=other;thing.xvel/=2.8;}
else{thing.FSM.collideCharacterSolid(thing,other);}};FullScreenMario.prototype.collideWaterBlocker=function(thing,other){thing.FSM.collideCharacterSolid(thing,other);};FullScreenMario.prototype.collideFlagpole=function(thing,other){if(thing.bottom>other.bottom){return;}
thing.FSM.ScenePlayer.startCutscene("Flagpole",{"player":thing,"collider":other});};FullScreenMario.prototype.collideCastleAxe=function(thing,other){if(!thing.FSM.MathDecider.compute("canPlayerTouchCastleAxe",thing,other)){return;}
thing.FSM.ScenePlayer.startCutscene("BowserVictory",{"player":thing,"axe":other});};FullScreenMario.prototype.collideCastleDoor=function(thing,other){thing.FSM.killNormal(thing);if(!thing.player){return;}
var time=thing.FSM.ItemsHolder.getItem("time");thing.FSM.ScenePlayer.addCutsceneSetting("player",thing);thing.FSM.ScenePlayer.addCutsceneSetting("detector",other);thing.FSM.ScenePlayer.addCutsceneSetting("time",time);if(time===Infinity){thing.FSM.ScenePlayer.playRoutine("Fireworks");}
else{thing.FSM.ScenePlayer.playRoutine("Countdown");}};FullScreenMario.prototype.collideCastleNPC=function(thing,other){var keys=other.collection.npc.collectionKeys;thing.FSM.ScenePlayer.addCutsceneSetting("keys",keys);thing.FSM.ScenePlayer.addCutsceneSetting("player",thing);thing.FSM.ScenePlayer.addCutsceneSetting("detector",other);thing.FSM.ScenePlayer.playRoutine("Dialog");};FullScreenMario.prototype.collideTransport=function(thing,other){if(!thing.player){return;}
thing.FSM.collideCharacterSolid(thing,other);if(thing.resting!==other){return;}
other.xvel=thing.FSM.unitsize/2;other.movement=thing.FSM.movePlatform;other.collide=thing.FSM.collideCharacterSolid;};FullScreenMario.prototype.collideDetector=function(thing,other){if(!thing.player){if(other.activateFail){other.activateFail(thing);}
return;}
other.activate(thing,other);if(!other.noActivateDeath){thing.FSM.killNormal(other);}};FullScreenMario.prototype.collideLevelTransport=function(thing,other){var transport=other.transport;if(!thing.player){return;}
if(typeof transport==="undefined"){throw new Error("No transport given to collideLevelTransport");}
if(transport.constructor===String){thing.FSM.setLocation(transport);}
else if(typeof transport.map!=="undefined"){if(typeof transport.location!=="undefined"){thing.FSM.setMap(transport.map,transport.location);}
else{thing.FSM.setMap(transport.map);}}
else if(typeof transport.location!=="undefined"){thing.FSM.setLocation(transport.location);}
else{throw new Error("Unknown transport type:"+transport);}};FullScreenMario.prototype.moveSimple=function(thing){if(thing.direction!==thing.moveleft){if(thing.moveleft){thing.xvel=-thing.speed;if(!thing.noflip){thing.FSM.unflipHoriz(thing);}}
else{thing.xvel=thing.speed;if(!thing.noflip){thing.FSM.flipHoriz(thing);}}
thing.direction=thing.moveleft;}};FullScreenMario.prototype.moveSmart=function(thing){thing.FSM.moveSimple(thing);if(thing.yvel!==0){return;}
if(!thing.resting||!thing.FSM.isCharacterOnResting(thing,thing.resting)){if(thing.moveleft){thing.FSM.shiftHoriz(thing,thing.FSM.unitsize,true);}
else{thing.FSM.shiftHoriz(thing,-thing.FSM.unitsize,true);}
thing.moveleft=!thing.moveleft;}};FullScreenMario.prototype.moveJumping=function(thing){thing.FSM.moveSimple(thing);if(thing.resting){thing.yvel=-Math.abs(thing.jumpheight);thing.resting=undefined;}};FullScreenMario.prototype.movePacing=function(thing){thing.counter+=.007;thing.xvel=Math.sin(Math.PI*thing.counter)/2.1;};FullScreenMario.prototype.moveHammerBro=function(thing){thing.FSM.movePacing(thing);thing.FSM.lookTowardsPlayer(thing);thing.nocollidesolid=thing.yvel<0||thing.falling;};FullScreenMario.prototype.moveBowser=function(thing){if(thing.flipHoriz){if(thing.FSM.objectToLeft(thing,thing.FSM.player)){thing.FSM.moveSimple(thing);}
else{thing.lookleft=thing.moveleft=true;thing.FSM.unflipHoriz(thing);thing.FSM.movePacing(thing);}}
else{if(thing.FSM.objectToLeft(thing,thing.FSM.player)){thing.lookleft=thing.moveleft=false;thing.FSM.flipHoriz(thing);thing.FSM.moveSimple(thing);}
else{thing.FSM.movePacing(thing);}}};FullScreenMario.prototype.moveBowserFire=function(thing){if(Math.round(thing.bottom)===Math.round(thing.ylev)){thing.movement=undefined;return;}
thing.FSM.shiftVert(thing,Math.min(Math.max(0,thing.ylev-thing.bottom),thing.FSM.unitsize));};FullScreenMario.prototype.moveFloating=function(thing){if(thing.top<=thing.end){thing.yvel=Math.min(thing.yvel+thing.FSM.unitsize/64,thing.maxvel);}
else if(thing.bottom>=thing.begin){thing.yvel=Math.max(thing.yvel-thing.FSM.unitsize/64,-thing.maxvel);}
thing.FSM.movePlatform(thing);};FullScreenMario.prototype.moveSliding=function(thing){if(thing.FSM.MapScreener.left+thing.left<=thing.begin){thing.xvel=Math.min(thing.xvel+thing.FSM.unitsize/64,thing.maxvel);}
else if(thing.FSM.MapScreener.left+thing.right>thing.end){thing.xvel=Math.max(thing.xvel-thing.FSM.unitsize/64,-thing.maxvel);}
thing.FSM.movePlatform(thing);};FullScreenMario.prototype.setMovementEndpoints=function(thing){if(thing.begin>thing.end){var temp=thing.begin;thing.begin=thing.end;thing.end=temp;}
thing.begin*=thing.FSM.unitsize;thing.end*=thing.FSM.unitsize;};FullScreenMario.prototype.movePlatform=function(thing){thing.FSM.shiftHoriz(thing,thing.xvel);thing.FSM.shiftVert(thing,thing.yvel);if(thing===thing.FSM.player.resting&&thing.FSM.player.alive){thing.FSM.setBottom(thing.FSM.player,thing.top);thing.FSM.shiftHoriz(thing.FSM.player,thing.xvel);if(thing.FSM.player.right>thing.FSM.MapScreener.width){thing.FSM.setRight(thing.FSM.player,thing.FSM.MapScreener.width);}
else if(thing.FSM.player.left<0){thing.FSM.setLeft(thing.FSM.player,0);}}};FullScreenMario.prototype.movePlatformSpawn=function(thing){if(thing.bottom<0){thing.FSM.setTop(thing,thing.FSM.MapScreener.bottomPlatformMax);}
else if(thing.top>thing.FSM.MapScreener.bottomPlatformMax){thing.FSM.setBottom(thing,0);}
else{thing.FSM.movePlatform(thing);return;}
if(thing.FSM.player&&thing.FSM.player.resting===thing){thing.FSM.player.resting=undefined;}};FullScreenMario.prototype.moveFalling=function(thing){if(thing.FSM.player.resting!==thing){thing.yvel=0;return;}
thing.FSM.shiftVert(thing,thing.yvel+=thing.FSM.unitsize/8);thing.FSM.setBottom(thing.FSM.player,thing.top);if(thing.yvel>=(thing.fallThresholdStart||thing.FSM.unitsize*2.8)){thing.freefall=true;thing.movement=thing.FSM.moveFreeFalling;}};FullScreenMario.prototype.moveFreeFalling=function(thing){thing.yvel+=thing.acceleration||thing.FSM.unitsize/16;thing.FSM.shiftVert(thing,thing.yvel);if(thing.yvel>=(thing.fallThresholdEnd||thing.FSM.unitsize*2)){thing.movement=thing.FSM.movePlatform;}};FullScreenMario.prototype.movePlatformScale=function(thing){if(thing.FSM.player.resting===thing){thing.yvel+=thing.FSM.unitsize/16;}
else if(thing.yvel>0){if(!thing.partners){thing.yvel=0;}
else{thing.yvel=Math.max(thing.yvel-thing.FSM.unitsize/16,0);}}
else{return;}
thing.tension+=thing.yvel;thing.FSM.shiftVert(thing,thing.yvel);if(!thing.partners){return;}
thing.partners.partnerPlatform.tension-=thing.yvel;if(thing.partners.partnerPlatform.tension<=0){thing.FSM.scoreOn(1000,thing);thing.partners.partnerPlatform.yvel=thing.FSM.unitsize/2;thing.collide=thing.partners.partnerPlatform.collide=(thing.FSM.collideCharacterSolid);thing.movement=thing.partners.partnerPlatform.movement=(thing.FSM.moveFreeFalling);}
thing.FSM.shiftVert(thing.partners.partnerPlatform,-thing.yvel);thing.FSM.setHeight(thing.partners.ownString,thing.partners.ownString.height+thing.yvel/thing.FSM.unitsize);thing.FSM.setHeight(thing.partners.partnerString,Math.max(thing.partners.partnerString.height-(thing.yvel/thing.FSM.unitsize),0));};FullScreenMario.prototype.moveVine=function(thing){thing.FSM.increaseHeight(thing,thing.speed);thing.FSM.updateSize(thing);if(thing.attachedSolid){thing.FSM.setBottom(thing,thing.attachedSolid.top);}
if(thing.attachedCharacter){thing.FSM.shiftVert(thing.attachedCharacter,-thing.speed);}};FullScreenMario.prototype.moveSpringboardUp=function(thing){var player=thing.FSM.player;thing.FSM.reduceHeight(thing,-thing.tension,true);thing.tension*=2;if(thing.height>thing.heightNormal){thing.FSM.reduceHeight(thing,(thing.height-thing.heightNormal)*thing.FSM.unitsize);if(thing===player.spring){player.yvel=thing.FSM.MathDecider.compute("springboardYvelUp",thing);player.resting=player.spring=undefined;player.movement=thing.FSM.movePlayer;}
thing.tension=0;thing.movement=undefined;}
else{thing.FSM.setBottom(player,thing.top);}
if(thing===player.spring){if(!thing.FSM.isThingTouchingThing(player,thing)){player.spring=undefined;player.movement=FullScreenMario.prototype.movePlayer;}}};FullScreenMario.prototype.moveShell=function(thing){if(thing.xvel!==0){return;}
thing.counting+=1;if(thing.counting===350){thing.peeking=1;thing.height+=thing.FSM.unitsize/8;thing.FSM.addClass(thing,"peeking");thing.FSM.updateSize(thing);}
else if(thing.counting===455){thing.peeking=2;}
else if(thing.counting===490){thing.spawnSettings={"smart":thing.smart};thing.FSM.killSpawn(thing);}};FullScreenMario.prototype.movePiranha=function(thing){var bottom=thing.bottom,height=thing.height+thing.direction,atEnd=false;if(thing.resting&&!thing.FSM.isThingAlive(thing.resting)){bottom=thing.constructor.prototype.height*thing.FSM.unitsize+thing.top;height=Infinity;thing.resting=undefined;}
if(height<=0){height=thing.height=0;atEnd=true;}
else if(height>=thing.constructor.prototype.height){height=thing.height=thing.constructor.prototype.height;atEnd=true;}
thing.FSM.setHeight(thing,height);thing.FSM.setBottom(thing,bottom);thing.canvas.height=height*thing.FSM.unitsize;thing.FSM.PixelDrawer.setThingSprite(thing);if(atEnd){thing.counter=0;thing.movement=thing.FSM.movePiranhaLatent;}};FullScreenMario.prototype.movePiranhaLatent=function(thing){var playerX=thing.FSM.getMidX(thing.FSM.player);if(thing.counter>=thing.countermax&&(thing.height>0||playerX<thing.left-thing.FSM.unitsize*8||playerX>thing.right+thing.FSM.unitsize*8)){thing.movement=undefined;thing.direction*=-1;thing.FSM.TimeHandler.addEvent(function(){thing.movement=thing.FSM.movePiranha;},7);}
else{thing.counter+=1;}};FullScreenMario.prototype.moveBubble=function(thing){if(thing.top<(thing.FSM.MapScreener.top
+thing.FSM.unitsize*16)){thing.FSM.killNormal(thing);}};FullScreenMario.prototype.moveCheepCheep=function(thing){if(thing.top<thing.FSM.unitsize*16){thing.FSM.setTop(thing,thing.FSM.unitsize*16);thing.yvel*=-1;return;}};FullScreenMario.prototype.moveCheepCheepFlying=function(thing){if(thing.top<thing.FSM.unitsize*28){thing.movement=undefined;thing.nofall=false;}};FullScreenMario.prototype.moveBlooper=function(thing){if(!thing.FSM.isThingAlive(thing.FSM.player)){thing.xvel=thing.FSM.unitsize/-4;thing.yvel=0;thing.movement=undefined;return;}
switch(thing.counter){case 56:thing.squeeze=1;thing.counter+=1;break;case 63:thing.FSM.moveBlooperSqueezing(thing);break;default:thing.counter+=1;if(thing.top<thing.FSM.unitsize*18){thing.FSM.moveBlooperSqueezing(thing);}
break;}
if(thing.squeeze){thing.yvel=Math.max(thing.yvel+.021,.7);}
else{thing.yvel=Math.min(thing.yvel-.035,-.7);}
if(thing.top>thing.FSM.unitsize*16){thing.FSM.shiftVert(thing,thing.yvel,true);}
if(!thing.squeeze){if(thing.FSM.player.left>thing.right+thing.FSM.unitsize*8){thing.xvel=Math.min(thing.speed,thing.xvel+thing.FSM.unitsize/32);}
else if(thing.FSM.player.right<thing.left-thing.FSM.unitsize*8){thing.xvel=Math.max(-thing.speed,thing.xvel-thing.FSM.unitsize/32);}}};FullScreenMario.prototype.moveBlooperSqueezing=function(thing){if(thing.squeeze!==2){thing.squeeze=2;thing.FSM.addClass(thing,"squeeze");thing.FSM.setHeight(thing,10,true,true);}
if(thing.squeeze<7){thing.xvel/=1.4;}
else if(thing.squeeze===7){thing.xvel=0;}
thing.squeeze+=1;if(thing.top>thing.FSM.player.bottom||thing.bottom>thing.FSM.unitsize*91){thing.FSM.animateBlooperUnsqueezing(thing);}};FullScreenMario.prototype.movePodobooFalling=function(thing){if(thing.top>=thing.starty){thing.yvel=0;thing.movement=undefined;thing.FSM.unflipVert(thing);thing.FSM.setTop(thing,thing.starty);return;}
if(thing.yvel>=thing.speed){thing.yvel=thing.speed;return;}
if(!thing.flipVert&&thing.yvel>0){thing.FSM.flipVert(thing);}
thing.yvel+=thing.acceleration;};FullScreenMario.prototype.moveLakitu=function(thing){var player=thing.FSM.player;if(player.xvel>thing.FSM.unitsize/8&&player.left>thing.FSM.MapScreener.width/2){if(thing.left<player.right+thing.FSM.unitsize*16){thing.FSM.slideToX(thing,player.right+player.xvel+thing.FSM.unitsize*32,player.maxspeed*1.4);thing.counter=0;}}
else{thing.counter+=.007;thing.FSM.slideToX(thing,player.left+player.xvel+Math.sin(Math.PI*thing.counter)*117,player.maxspeed*.7);}};FullScreenMario.prototype.moveLakituInitial=function(thing){if(thing.right<thing.FSM.player.left){thing.counter=0;thing.movement=thing.FSM.moveLakitu;thing.movement(thing);return;}
thing.FSM.shiftHoriz(thing,-thing.FSM.unitsize);};FullScreenMario.prototype.moveLakituFleeing=function(thing){thing.FSM.shiftHoriz(thing,-thing.FSM.unitsize);};FullScreenMario.prototype.moveCoinEmerge=function(thing,parent){thing.FSM.shiftVert(thing,thing.yvel);if(parent&&thing.bottom>=thing.blockparent.bottom){thing.FSM.killNormal(thing);}};FullScreenMario.prototype.movePlayer=function(thing){if(!thing.keys.up){thing.keys.jump=false;}
else if(thing.keys.jump&&(thing.yvel<=0||thing.FSM.MapScreener.underwater)){if(thing.FSM.MapScreener.underwater){thing.FSM.animatePlayerPaddling(thing);thing.FSM.removeClass(thing,"running");}
if(thing.resting){if(thing.resting.xvel){thing.xvel+=thing.resting.xvel;}
thing.resting=undefined;}
else{if(!thing.jumping&&!thing.FSM.MapScreener.underwater){thing.FSM.switchClass(thing,"running skidding","jumping");}
thing.jumping=true;if(thing.power>1&&thing.crouching){thing.FSM.removeClass(thing,"jumping");}}
if(!thing.FSM.MapScreener.underwater){thing.keys.jumplev+=1;thing.FSM.MathDecider.compute("decreasePlayerJumpingYvel",thing);}}
if(thing.keys.crouch&&!thing.crouching&&thing.resting){if(thing.power>1){thing.crouching=true;thing.FSM.removeClass(thing,"running");thing.FSM.addClass(thing,"crouching");thing.FSM.setHeight(thing,11,true,true);thing.height=11;thing.tolyOld=thing.toly;thing.toly=thing.FSM.unitsize*4;thing.FSM.updateBottom(thing,0);thing.FSM.updateSize(thing);}
if(thing.resting.actionTop){thing.FSM.ModAttacher.fireEvent("onPlayerActionTop",thing,thing.resting);thing.resting.actionTop(thing,thing.resting);}}
if(thing.FSM.MathDecider.compute("decreasePlayerRunningXvel",thing)){if(thing.skidding){thing.FSM.addClass(thing,"skidding");}
else{thing.FSM.removeClass(thing,"skidding");}}
if(Math.abs(thing.xvel)<.14){if(thing.running){thing.running=false;if(thing.power===1){thing.FSM.setPlayerSizeSmall(thing);}
thing.FSM.removeClasses(thing,"running skidding one two three");thing.FSM.addClass(thing,"still");thing.FSM.TimeHandler.cancelClassCycle(thing,"running");}}
else if(!thing.running){thing.running=true;thing.FSM.animatePlayerRunningCycle(thing);if(thing.power===1){thing.FSM.setPlayerSizeSmall(thing);}}
if(thing.xvel>0){thing.xvel=Math.min(thing.xvel,thing.maxspeed);if(thing.moveleft&&(thing.resting||thing.FSM.MapScreener.underwater)){thing.FSM.unflipHoriz(thing);thing.moveleft=false;}}
else if(thing.xvel<0){thing.xvel=Math.max(thing.xvel,thing.maxspeed*-1);if(!thing.moveleft&&(thing.resting||thing.FSM.MapScreener.underwater)){thing.moveleft=true;thing.FSM.flipHoriz(thing);}}
if(thing.resting){if(thing.hopping){thing.hopping=false;thing.FSM.removeClass(thing,"hopping");if(thing.xvel){thing.FSM.addClass(thing,"running");}}
thing.keys.jumplev=thing.yvel=thing.jumpcount=0;if(thing.jumping){thing.jumping=false;thing.FSM.removeClass(thing,"jumping");if(thing.power===1){thing.FSM.setPlayerSizeSmall(thing);}
thing.FSM.addClass(thing,Math.abs(thing.xvel)<.14?"still":"running");}
if(thing.paddling){thing.paddling=thing.swimming=false;thing.FSM.TimeHandler.cancelClassCycle(thing,"paddling");thing.FSM.removeClasses(thing,"paddling swim1 swim2");thing.FSM.addClass(thing,"running");}}};FullScreenMario.prototype.movePlayerVine=function(thing){var attachedSolid=thing.attachedSolid,animatedClimbing;if(!attachedSolid){thing.movement=thing.FSM.movePlayer;return;}
if(thing.bottom<thing.attachedSolid.top){thing.FSM.unattachPlayer(thing,thing.attachedSolid);return;}
if(thing.keys.run!==0&&thing.keys.run===thing.attachedDirection){if(thing.attachedDirection===-1){thing.FSM.setRight(thing,attachedSolid.left-thing.FSM.unitsize);}
else if(thing.attachedDirection===1){thing.FSM.setLeft(thing,attachedSolid.right+thing.FSM.unitsize);}
thing.FSM.unattachPlayer(thing,attachedSolid);return;}
if(thing.keys.up){animatedClimbing=true;thing.FSM.shiftVert(thing,thing.FSM.unitsize/-4);}
else if(thing.keys.crouch){animatedClimbing=true;thing.FSM.shiftVert(thing,thing.FSM.unitsize/2);if(thing.top>attachedSolid.bottom){thing.FSM.unattachPlayer(thing,thing.attachedSolid);}
return;}
else{animatedClimbing=false;}
if(animatedClimbing&&!thing.animatedClimbing){thing.FSM.addClass(thing,"animated");}
else if(!animatedClimbing&&thing.animatedClimbing){thing.FSM.removeClass(thing,"animated");}
thing.animatedClimbing=animatedClimbing;if(thing.bottom<thing.FSM.MapScreener.top-thing.FSM.unitsize*4){thing.FSM.setLocation(thing.attachedSolid.transport);}};FullScreenMario.prototype.movePlayerSpringboardDown=function(thing){var other=thing.spring;if(!thing.FSM.isThingTouchingThing(thing,other)){thing.movement=thing.FSM.movePlayer;other.movement=thing.FSM.moveSpringboardUp;thing.spring=undefined;return;}
if(other.height<thing.FSM.unitsize*2.5||other.tension<thing.FSM.unitsize/32){thing.movement=undefined;other.movement=thing.FSM.moveSpringboardUp;return;}
if(thing.left<other.left+thing.FSM.unitsize*2||thing.right>other.right-thing.FSM.unitsize*2){thing.xvel/=1.4;}
thing.FSM.reduceHeight(other,other.tension,true);other.tension/=2;thing.FSM.setBottom(thing,other.top);thing.FSM.updateSize(other);};FullScreenMario.prototype.animateSolidBump=function(thing){var dx=-3;thing.FSM.TimeHandler.addEventInterval(function(thing){thing.FSM.shiftVert(thing,dx);dx+=.5;if(dx===3.5){thing.up=undefined;return true;}
return false;},1,Infinity,thing);};FullScreenMario.prototype.animateBlockBecomesUsed=function(thing){thing.used=true;thing.FSM.switchClass(thing,"unused","used");};FullScreenMario.prototype.animateSolidContents=function(thing,other){var output;if(other&&other.player&&other.power>1&&thing.contents==="Mushroom"){thing.contents="FireFlower";}
output=thing.FSM.addThing(thing.contents||thing.constructor.prototype.contents);thing.FSM.setMidXObj(output,thing);thing.FSM.setTop(output,thing.top);output.blockparent=thing;output.animate(output,thing);return output;};FullScreenMario.prototype.animateBrickShards=function(thing){var unitsize=thing.FSM.unitsize,shard,left,top,i;for(i=0;i<4;i+=1){left=thing.left+Number(i<2)*thing.width*unitsize-unitsize*2;top=thing.top+(i%2)*thing.height*unitsize-unitsize*2;shard=thing.FSM.addThing("BrickShard",left,top);shard.xvel=shard.speed=unitsize/2-unitsize*Number(i>1);shard.yvel=unitsize*-1.4+i%2;thing.FSM.TimeHandler.addEvent(thing.FSM.killNormal,70,shard);}};FullScreenMario.prototype.animateEmerge=function(thing,other){thing.nomove=thing.nocollide=thing.nofall=thing.alive=true;thing.FSM.flipHoriz(thing);thing.FSM.AudioPlayer.play("Powerup Appears");thing.FSM.arraySwitch(thing,thing.FSM.GroupHolder.getGroup("Character"),thing.FSM.GroupHolder.getGroup("Scenery"));thing.FSM.TimeHandler.addEventInterval(function(){thing.FSM.shiftVert(thing,thing.FSM.unitsize/-8);if(thing.bottom>other.top){return false;}
thing.FSM.setBottom(thing,other.top);thing.FSM.GroupHolder.switchObjectGroup(thing,"Scenery","Character");thing.nomove=thing.nocollide=thing.nofall=thing.moveleft=false;if(thing.emergeOut){thing.emergeOut(thing,other);}
if(thing.movement){thing.movementOld=thing.movement;thing.movement=thing.FSM.moveSimple;thing.FSM.TimeHandler.addEventInterval(function(){if(thing.resting===other){return false;}
thing.FSM.TimeHandler.addEvent(function(){thing.movement=thing.movementOld;},1);return true;},1,Infinity);}
return true;},1,Infinity);};FullScreenMario.prototype.animateEmergeCoin=function(thing,other){thing.nocollide=thing.alive=thing.nofall=true;thing.yvel-=thing.FSM.unitsize;thing.FSM.switchClass(thing,"still","anim");thing.FSM.GroupHolder.switchObjectGroup(thing,"Character","Scenery");thing.FSM.AudioPlayer.play("Coin");thing.FSM.ItemsHolder.increase("coins",1);thing.FSM.ItemsHolder.increase("score",200);thing.FSM.TimeHandler.cancelClassCycle(thing,"0");thing.FSM.TimeHandler.addClassCycle(thing,["anim1","anim2","anim3","anim4","anim3","anim2"],"0",5);thing.FSM.TimeHandler.addEventInterval(function(){thing.FSM.moveCoinEmerge(thing,other);return!thing.FSM.isThingAlive(thing);},1,Infinity);thing.FSM.TimeHandler.addEvent(function(){thing.FSM.killNormal(thing);},49);thing.FSM.TimeHandler.addEvent(function(){thing.yvel*=-1;},25);};FullScreenMario.prototype.animateEmergeVine=function(thing,solid){thing.attachedSolid=solid;thing.FSM.setHeight(thing,0);thing.FSM.AudioPlayer.play("Vine Emerging");thing.FSM.TimeHandler.addEvent(function(){thing.nocollide=false;},14);thing.FSM.TimeHandler.addEvent(function(){thing.movement=undefined;},700);};FullScreenMario.prototype.animateFlicker=function(thing,cleartime,interval){cleartime=Math.round(cleartime)||49;interval=Math.round(interval)||2;thing.flickering=true;thing.FSM.TimeHandler.addEventInterval(function(){thing.hidden=!thing.hidden;thing.FSM.PixelDrawer.setThingSprite(thing);},interval,cleartime);thing.FSM.TimeHandler.addEvent(function(){thing.flickering=thing.hidden=false;thing.FSM.PixelDrawer.setThingSprite(thing);},cleartime*interval+1);};FullScreenMario.prototype.animateThrowingHammer=function(thing,count){if(!thing.FSM.isThingAlive(thing)||!thing.FSM.isThingAlive(thing.FSM.player)||thing.right<thing.FSM.unitsize*-32){return true;}
if(count!==3){thing.FSM.switchClass(thing,"thrown","throwing");}
thing.FSM.TimeHandler.addEvent(function(){if(!thing.FSM.isThingAlive(thing)){return false;}
if(count!==3){thing.FSM.switchClass(thing,"throwing","thrown");thing.FSM.addThing(["Hammer",{"xvel":thing.lookleft?thing.FSM.unitsize/-1.4:thing.FSM.unitsize/1.4,"yvel":thing.FSM.unitsize*-1.4,"gravity":thing.FSM.MapScreener.gravity/2.1}],thing.left-thing.FSM.unitsize*2,thing.top-thing.FSM.unitsize*2);}
if(count>0){thing.FSM.TimeHandler.addEvent(thing.FSM.animateThrowingHammer,7,thing,count-1);}
else{thing.FSM.TimeHandler.addEvent(thing.FSM.animateThrowingHammer,70,thing,7);thing.FSM.removeClass(thing,"thrown");}},14);return false;};FullScreenMario.prototype.animateBowserJump=function(thing){if(!thing.lookleft||!thing.FSM.player){return false;}
if(!thing.FSM.isThingAlive(thing)||!thing.FSM.isThingAlive(thing.FSM.player)){return true;}
thing.resting=undefined;thing.yvel=thing.FSM.unitsize*-1.4;thing.nocollidesolid=true;thing.FSM.TimeHandler.addEventInterval(function(){if(thing.dead||thing.yvel>thing.FSM.unitsize){thing.nocollidesolid=false;return true;}
return false;},3,Infinity);return false;};FullScreenMario.prototype.animateBowserFire=function(thing){if(!thing.lookleft||!thing.lookleft||!thing.FSM.player){return false;}
if(!thing.FSM.isThingAlive(thing)||!thing.FSM.isThingAlive(thing.FSM.player)){return true;}
thing.FSM.addClass(thing,"firing");thing.FSM.AudioPlayer.playLocal("Bowser Fires",thing.left);thing.FSM.TimeHandler.addEvent(thing.FSM.animateBowserFireOpen,14,thing);return false;};FullScreenMario.prototype.animateBowserFireOpen=function(thing){var unitsize=thing.FSM.unitsize,ylev=Math.max(-thing.height*unitsize,Math.round(thing.FSM.player.bottom/(unitsize*8))*unitsize*8);if(!thing.FSM.isThingAlive(thing)){return true;}
thing.FSM.removeClass(thing,"firing");thing.FSM.addThing(["BowserFire",{"ylev":ylev}],thing.left-thing.FSM.unitsize*8,thing.top+thing.FSM.unitsize*4);return false;};FullScreenMario.prototype.animateBowserThrow=function(thing){if(!thing.lookleft||!thing.FSM.isThingAlive(thing)){return;}
var hammer=thing.FSM.addThing("Hammer",thing.left+thing.FSM.unitsize*2,thing.top-thing.FSM.unitsize*2);thing.FSM.TimeHandler.addEventInterval(function(){if(!thing.FSM.isThingAlive(thing)){thing.FSM.killNormal(hammer);return true;}
thing.FSM.setTop(hammer,thing.top-thing.FSM.unitsize*2);if(thing.lookleft){thing.FSM.setLeft(hammer,thing.left+thing.FSM.unitsize*2);}
else{thing.FSM.setLeft(hammer,thing.right-thing.FSM.unitsize*2);}
return true;},1,14);thing.FSM.TimeHandler.addEvent(function(){hammer.xvel=thing.FSM.unitsize*1.17;hammer.yvel=thing.FSM.unitsize*-2.1;if(thing.lookleft){hammer.xvel*=-1;}},14);return false;};FullScreenMario.prototype.animateBowserFreeze=function(thing){thing.nofall=true;thing.nothrow=true;thing.movement=undefined;thing.dead=true;thing.FSM.thingPauseVelocity(thing);thing.FSM.ScenePlayer.addCutsceneSetting("bowser",thing);thing.FSM.TimeHandler.addEvent(function(){thing.nofall=false;},70);};FullScreenMario.prototype.animateJump=function(thing){if(!thing.FSM.isThingAlive(thing)||!thing.FSM.isThingAlive(thing.FSM.player)){return true;}
if(!thing.resting){return false;}
if(thing.FSM.MapScreener.floor-(thing.bottom/thing.FSM.unitsize)>=30&&thing.resting.title!=="Floor"&&thing.FSM.NumberMaker.randomBoolean()){thing.falling=true;thing.yvel=thing.FSM.unitsize*-.7;thing.FSM.TimeHandler.addEvent(function(){thing.falling=false;},42);}
else{thing.nocollidesolid=true;thing.yvel=thing.FSM.unitsize*-2.1;thing.FSM.TimeHandler.addEvent(function(){thing.nocollidesolid=false;},42);}
thing.resting=undefined;return false;};FullScreenMario.prototype.animateBlooperUnsqueezing=function(thing){thing.counter=0;thing.squeeze=0;thing.FSM.removeClass(thing,"squeeze");thing.FSM.setHeight(thing,12,true,true);};FullScreenMario.prototype.animatePodobooJumpUp=function(thing){thing.starty=thing.top;thing.yvel=thing.speed*-1;thing.FSM.TimeHandler.addEvent(thing.FSM.animatePodobooJumpDown,thing.jumpHeight,thing);};FullScreenMario.prototype.animatePodobooJumpDown=function(thing){thing.movement=thing.FSM.movePodobooFalling;};FullScreenMario.prototype.animateLakituThrowingSpiny=function(thing){if(thing.fleeing||!thing.FSM.isThingAlive(thing)){return true;}
thing.FSM.switchClass(thing,"out","hiding");thing.FSM.TimeHandler.addEvent(function(){if(thing.dead){return;}
var spawn=thing.FSM.addThing("SpinyEgg",thing.left,thing.top);spawn.yvel=thing.FSM.unitsize*-2.1;thing.FSM.switchClass(thing,"hiding","out");},21);};FullScreenMario.prototype.animateSpinyEggHatching=function(thing){if(!thing.FSM.isThingAlive(thing)){return;}
var spawn=thing.FSM.addThing("Spiny",thing.left,thing.top-thing.yvel);spawn.moveleft=thing.FSM.objectToLeft(thing.FSM.player,spawn);thing.FSM.killNormal(thing);};FullScreenMario.prototype.animateFireballEmerge=function(thing){thing.FSM.AudioPlayer.play("Fireball");};FullScreenMario.prototype.animateFireballExplode=function(thing,big){thing.nocollide=true;thing.FSM.killNormal(thing);if(big===2){return;}
var output=thing.FSM.addThing("Firework");thing.FSM.setMidXObj(output,thing);thing.FSM.setMidYObj(output,thing);output.animate(output);};FullScreenMario.prototype.animateFirework=function(thing){var name=thing.className+" n",i;for(i=0;i<3;i+=1){thing.FSM.TimeHandler.addEvent(function(i){thing.FSM.setClass(thing,name+String(i+1));},i*7,i);}
thing.FSM.AudioPlayer.play("Firework");thing.FSM.TimeHandler.addEvent(function(){thing.FSM.killNormal(thing);},i*7);};FullScreenMario.prototype.animateCannonFiring=function(thing){if(!thing.FSM.isThingAlive(thing)){return;}
if(thing.FSM.player.right>(thing.left-thing.FSM.unitsize*8)&&thing.FSM.player.left<(thing.right+thing.FSM.unitsize*8)){return;}
var spawn=thing.FSM.ObjectMaker.make("BulletBill");if(thing.FSM.objectToLeft(thing.FSM.player,thing)){spawn.direction=spawn.moveleft=true;spawn.xvel*=-1;thing.FSM.flipHoriz(spawn);thing.FSM.addThing(spawn,thing.left,thing.top);}
else{thing.FSM.addThing(spawn,thing.left+thing.width,thing.top);}
thing.FSM.AudioPlayer.playLocal("Bump",thing.right);};FullScreenMario.prototype.animatePlayerFire=function(thing){if(thing.numballs>=2){return;}
var xloc=thing.moveleft?(thing.left-thing.FSM.unitsize/4):(thing.right+thing.FSM.unitsize/4),ball=thing.FSM.ObjectMaker.make("Fireball",{"moveleft":thing.moveleft,"speed":thing.FSM.unitsize*1.75,"jumpheight":thing.FSM.unitsize*1.56,"gravity":thing.FSM.MapScreener.gravity*1.56,"yvel":thing.FSM.unitsize,"movement":thing.FSM.moveJumping});thing.FSM.addThing(ball,xloc,thing.top+thing.FSM.unitsize*8);ball.animate(ball);ball.onDelete=function(){thing.numballs-=1;};thing.numballs+=1;thing.FSM.addClass(thing,"firing");thing.FSM.TimeHandler.addEvent(function(){thing.FSM.removeClass(thing,"firing");},7);};FullScreenMario.prototype.animateCastleBlock=function(thing,balls){var midx=thing.EightBitter.getMidX(thing),midy=thing.EightBitter.getMidY(thing),ax=Math.cos(thing.angle*Math.PI)*thing.FSM.unitsize*4,ay=Math.sin(thing.angle*Math.PI)*thing.FSM.unitsize*4,i;for(i=0;i<balls.length;i+=1){thing.FSM.setMidX(balls[i],midx+ax*i);thing.FSM.setMidY(balls[i],midy+ay*i);}
thing.angle+=thing.dt*thing.direction;};FullScreenMario.prototype.animateCastleBridgeOpen=function(thing){thing.FSM.ScenePlayer.playRoutine("CastleBridgeOpen",thing);};FullScreenMario.prototype.animateCastleChainOpen=function(thing){thing.FSM.TimeHandler.addEvent(thing.FSM.killNormal,3,thing);};FullScreenMario.prototype.animatePlayerPaddling=function(thing){if(!thing.paddlingCycle){thing.FSM.removeClasses(thing,"skidding paddle1 paddle2 paddle3 paddle4 paddle5");thing.FSM.addClass(thing,"paddling");thing.FSM.TimeHandler.cancelClassCycle(thing,"paddlingCycle");thing.FSM.TimeHandler.addClassCycle(thing,["paddle1","paddle2","paddle3","paddle2","paddle1",function(){return thing.paddlingCycle=false;},],"paddlingCycle",7);}
thing.paddling=thing.paddlingCycle=thing.swimming=true;thing.yvel=thing.FSM.unitsize*-.84;};FullScreenMario.prototype.animatePlayerLanding=function(thing){if(thing.crouching&&thing.power>1){thing.FSM.setHeight(thing,11,true,true);}
if(thing.FSM.hasClass(thing,"hopping")){thing.FSM.switchClass(thing,"hopping","jumping");}
if(thing.FSM.MapScreener.underwater){thing.FSM.removeClass(thing,"paddling");}
thing.FSM.ModAttacher.fireEvent("onPlayerLanding",thing,thing.resting);};FullScreenMario.prototype.animatePlayerRestingOff=function(thing){thing.resting=undefined;if(thing.FSM.MapScreener.underwater){thing.FSM.switchClass(thing,"running","paddling");}};FullScreenMario.prototype.animatePlayerBubbling=function(thing){thing.FSM.addThing("Bubble",thing.right,thing.top);};FullScreenMario.prototype.animatePlayerRunningCycle=function(thing){thing.FSM.switchClass(thing,"still","running");thing.running=thing.FSM.TimeHandler.addClassCycle(thing,["one","two","three","two"],"running",function(event){event.timeout=5+Math.ceil(thing.maxspeedsave-Math.abs(thing.xvel));});};FullScreenMario.prototype.animateCharacterHop=function(thing){thing.resting=undefined;thing.yvel=thing.FSM.unitsize*-1.4;};FullScreenMario.prototype.animatePlayerPipingStart=function(thing){thing.nocollide=thing.nofall=thing.piping=true;thing.xvel=thing.yvel=0;thing.movementOld=thing.movement;thing.movement=undefined;if(thing.power>1){thing.FSM.animatePlayerRemoveCrouch(thing);thing.FSM.setPlayerSizeLarge(thing);}
else{thing.FSM.setPlayerSizeSmall(thing);}
thing.FSM.removeClasses(thing,"jumping running crouching");thing.FSM.AudioPlayer.clearTheme();thing.FSM.TimeHandler.cancelAllCycles(thing);thing.FSM.GroupHolder.switchObjectGroup(thing,"Character","Scenery");};FullScreenMario.prototype.animatePlayerPipingEnd=function(thing){thing.movement=thing.movementOld;thing.nocollide=thing.nofall=thing.piping=false;thing.FSM.AudioPlayer.resumeTheme();thing.FSM.GroupHolder.switchObjectGroup(thing,"Scenery","Character");};FullScreenMario.prototype.animatePlayerOffPole=function(thing,doRun){thing.FSM.removeClasses(thing,"climbing running");thing.FSM.addClass(thing,"jumping");thing.xvel=1.4;thing.yvel=-.7;thing.nocollide=thing.nofall=false;thing.gravity=thing.FSM.MapScreener.gravity/14;thing.FSM.TimeHandler.addEvent(function(){thing.movement=thing.FSM.movePlayer;thing.gravity=thing.FSM.MapScreener.gravity;thing.FSM.unflipHoriz(thing);if(doRun){thing.FSM.animatePlayerRunningCycle(thing);}},21);};FullScreenMario.prototype.animatePlayerOffVine=function(thing){thing.FSM.flipHoriz(thing);thing.FSM.shiftHoriz(thing,(thing.width-1)*thing.FSM.unitsize);thing.FSM.TimeHandler.addEvent(thing.FSM.animatePlayerOffPole,14,thing);};FullScreenMario.prototype.lookTowardsThing=function(thing,other){if(other.right<=thing.left){thing.lookleft=true;thing.moveleft=true;thing.FSM.unflipHoriz(thing);}
else if(other.left>=thing.right){thing.lookleft=false;thing.moveleft=false;thing.FSM.flipHoriz(thing);}};FullScreenMario.prototype.lookTowardsPlayer=function(thing,big){if(thing.FSM.player.right<=thing.left){if(!thing.lookleft||big){thing.lookleft=true;thing.moveleft=false;thing.FSM.unflipHoriz(thing);}}
else if(thing.FSM.player.left>=thing.right){if(thing.lookleft||big){thing.lookleft=false;thing.moveleft=true;thing.FSM.flipHoriz(thing);}}};FullScreenMario.prototype.killNormal=function(thing){if(!thing){return;}
thing.hidden=thing.dead=true;thing.alive=false;thing.numquads=0;thing.movement=undefined;if(this.hasOwnProperty("resting")){thing.resting=undefined;}
if(thing.FSM){thing.FSM.TimeHandler.cancelAllCycles(thing);}
thing.FSM.ModAttacher.fireEvent("onKillNormal",thing);};FullScreenMario.prototype.killFlip=function(thing,extra){if(extra===void 0){extra=0;}
thing.FSM.flipVert(thing);if(thing.bottomBump){thing.bottomBump=undefined;}
thing.nocollide=thing.dead=true;thing.speed=thing.xvel=0;thing.nofall=false;thing.resting=thing.movement=undefined;thing.yvel=-thing.FSM.unitsize;thing.FSM.TimeHandler.addEvent(thing.FSM.killNormal,70+extra,thing);};FullScreenMario.prototype.killSpawn=function(thing,big){if(big){thing.FSM.killNormal(thing);return;}
if(!thing.spawnType){throw new Error("Thing "+thing.title+" has no .spawnType.");}
var spawn=thing.FSM.ObjectMaker.make(thing.spawnType,thing.spawnSettings||{});thing.FSM.addThing(spawn);thing.FSM.setBottom(spawn,thing.bottom);thing.FSM.setMidXObj(spawn,thing);thing.FSM.killNormal(thing);return spawn;};FullScreenMario.prototype.killReplace=function(thing,title,attributes,attributesCopied){var spawn,i;if(typeof attributes==="undefined"){attributes={};}
if(typeof attributesCopied!=="undefined"){for(i=0;i<attributesCopied.length;i+=1){attributes[attributesCopied[i]]=thing[attributesCopied[i]];}}
spawn=thing.FSM.ObjectMaker.make(title,attributes);if(thing.flipHoriz){thing.FSM.flipHoriz(spawn);}
if(thing.flipVert){thing.FSM.flipVert(spawn);}
thing.FSM.addThing(spawn,thing.left,thing.top);thing.FSM.killNormal(thing);return spawn;};FullScreenMario.prototype.killGoomba=function(thing,big){if(big){thing.FSM.killFlip(thing);return;}
thing.FSM.killSpawn(thing);};FullScreenMario.prototype.killKoopa=function(thing,big){var spawn;if(thing.jumping||thing.floating){spawn=thing.FSM.killReplace(thing,"Koopa",undefined,["smart","direction","moveleft"]);spawn.xvel=spawn.moveleft?-spawn.speed:spawn.speed;}
else{spawn=thing.FSM.killToShell(thing,Number(big));}
return spawn;};FullScreenMario.prototype.killLakitu=function(thing){var characters=thing.FSM.GroupHolder.getGroup("Character"),i;thing.FSM.killFlip(thing);thing.FSM.MapScreener.lakitu=undefined;for(i=0;i<characters.length;i+=1){if(characters[i].title==="Lakitu"){thing.FSM.MapScreener.lakitu=characters[i];return;}}
thing.FSM.TimeHandler.addEvent(thing.FSM.addThing.bind(thing.FSM),350,"Lakitu",thing.FSM.MapScreener.right,thing.top);};FullScreenMario.prototype.killBowser=function(thing,big){if(big){thing.nofall=false;thing.movement=undefined;thing.FSM.killFlip(thing.FSM.killSpawn(thing));return;}
thing.deathcount+=1;if(thing.deathcount===5){thing.yvel=thing.speed=0;thing.movement=undefined;thing.FSM.killFlip(thing.FSM.killSpawn(thing),350);thing.FSM.scoreOn(5000,thing);}};FullScreenMario.prototype.killToShell=function(thing,big){var spawn,nocollidecharold,nocollideplayerold;thing.spawnSettings={"smart":thing.smart};if(big&&big!==2){thing.spawnType=thing.title;}
else{thing.spawnType=thing.shelltype||"Shell";}
thing.spawnSettings={"smart":thing.smart};spawn=thing.FSM.killSpawn(thing);nocollidecharold=spawn.nocollidechar;nocollideplayerold=spawn.nocollideplayer;spawn.nocollidechar=true;spawn.nocollideplayer=true;thing.FSM.TimeHandler.addEvent(function(){spawn.nocollidechar=nocollidecharold;spawn.nocollideplayer=nocollideplayerold;},7);thing.FSM.killNormal(thing);if(big===2){thing.FSM.killFlip(spawn);}
return spawn;};FullScreenMario.prototype.killNPCs=function(){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),group,character,solid,i;group=FSM.GroupHolder.getGroup("Character");for(i=group.length-1;i>=0;--i){character=group[i];if(!character.nokillend){character.FSM.killNormal(character);character.FSM.arrayDeleteThing(character,group,i);}
else if(character.killonend){character.killonend(character);}}
group=FSM.GroupHolder.getGroup("Solid");for(i=group.length-1;i>=0;--i){solid=group[i];if(solid.killonend){if(solid.killonend.constructor===Function){solid.killonend(solid,group,i);}
else{solid.FSM.arrayDeleteThing(solid,group,i);}}}};FullScreenMario.prototype.killBrick=function(thing,other){thing.FSM.AudioPlayer.play("Break Block");thing.FSM.TimeHandler.addEvent(thing.FSM.animateBrickShards,1,thing);thing.FSM.killNormal(thing);if(other instanceof thing.FSM.ObjectMaker.getFunction("Thing")){thing.up=other;}
else{thing.up=undefined;}};FullScreenMario.prototype.killPlayer=function(thing,big){if(!thing.alive||thing.flickering||thing.dying){return;}
var FSM=thing.FSM,area=thing.FSM.MapsHandler.getArea();if(big===2){thing.dead=thing.dying=true;thing.alive=false;FSM.MapScreener.notime=true;}
else{if(!big&&thing.power>1){thing.power=1;FSM.ItemsHolder.setItem("power",1);FSM.AudioPlayer.play("Power Down");FSM.playerGetsSmall(thing);return;}
else{thing.dying=true;FSM.setSize(thing,7.5,7,true);FSM.updateSize(thing);FSM.setClass(thing,"character player dead");FSM.thingPauseVelocity(thing);FSM.arrayToEnd(thing,FSM.GroupHolder.getGroup(thing.groupType));FSM.MapScreener.notime=true;FSM.MapScreener.nokeys=true;FSM.TimeHandler.cancelAllCycles(thing);FSM.TimeHandler.addEvent(function(){FSM.thingResumeVelocity(thing,true);thing.nocollide=true;thing.movement=thing.resting=undefined;thing.gravity=FSM.MapScreener.gravity/2.1;thing.yvel=FullScreenMario.unitsize*-1.4;},7);}}
thing.nocollide=thing.nomove=thing.dead=true;FSM.MapScreener.nokeys=true;FSM.AudioPlayer.clearAll();FSM.AudioPlayer.play("Player Dies");FSM.ItemsHolder.decrease("lives");FSM.ItemsHolder.setItem("power",1);if(FSM.ItemsHolder.getItem("lives")>0){FSM.TimeHandler.addEvent(area.onPlayerDeath.bind(FSM),area.onPlayerDeathTimeout,FSM);}
else{FSM.TimeHandler.addEvent(area.onGameOver.bind(FSM),area.onGameOverTimeout,FSM);}};FullScreenMario.prototype.findScore=function(level){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this);if(level<FSM.pointLevels.length){return FSM.pointLevels[level];}
FSM.gainLife(1);return 0;};FullScreenMario.prototype.score=function(value,continuation){if(!value){return;}
var FSM=FullScreenMario.prototype.ensureCorrectCaller(this);FSM.scoreOn(value,FSM.player,true);if(!continuation){this.ItemsHolder.increase("score",value);}};FullScreenMario.prototype.scoreOn=function(value,thing,continuation){if(!value){return;}
var text=thing.FSM.addThing("Text"+value);thing.FSM.scoreAnimateOn(text,thing);if(!continuation){this.ItemsHolder.increase("score",value);}
thing.FSM.ModAttacher.fireEvent("onScoreOn",value,thing,continuation);};FullScreenMario.prototype.scoreAnimateOn=function(text,thing){thing.FSM.setMidXObj(text,thing);thing.FSM.setBottom(text,thing.top);thing.FSM.scoreAnimate(text);};FullScreenMario.prototype.scoreAnimate=function(thing,timeout){if(timeout===void 0){timeout=28;}
thing.FSM.TimeHandler.addEventInterval(thing.FSM.shiftVert,1,timeout,thing,-thing.FSM.unitsize/6);thing.FSM.TimeHandler.addEvent(thing.FSM.killNormal,timeout,thing);};FullScreenMario.prototype.scorePlayerShell=function(thing,other){if(thing.star){thing.FSM.scoreOn(200,other);return;}
if(!other.resting){thing.FSM.scoreOn(8000,other);return;}
if(other.peeking){thing.FSM.scoreOn(1000,other);return;}
if(thing.jumpcount){thing.FSM.scoreOn(500,other);return;}
thing.FSM.scoreOn(400,other);};FullScreenMario.prototype.scorePlayerFlag=function(thing,difference){var amount;if(difference<28){amount=difference<8?100:400;}
else if(difference<40){amount=800;}
else{amount=difference<62?2000:5000;}
return amount;};FullScreenMario.prototype.getVolumeLocal=function(FSM,xloc){if(xloc>FSM.MapScreener.right){return 0;}
return Math.max(.14,Math.min(.84,(FSM.MapScreener.width-Math.abs(xloc-FSM.player.left))/FSM.MapScreener.width));};FullScreenMario.prototype.getAudioThemeDefault=function(FSM){return FSM.MapsHandler.getArea().setting.split(" ")[0];};FullScreenMario.prototype.setMap=function(name,location){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),time,map;if(typeof name==="undefined"||name.constructor===FullScreenMario){name=FSM.MapsHandler.getMapName();}
map=FSM.MapsHandler.setMap(name);FSM.ModAttacher.fireEvent("onPreSetMap",map);if(map.seed){FSM.NumberMaker.resetFromSeed(map.seed);}
FSM.ItemsHolder.setItem("world",name);FSM.InputWriter.restartHistory();FSM.ModAttacher.fireEvent("onSetMap",map);FSM.setLocation(location||map.locationDefault||FSM.settings.maps.locationDefault);time=FSM.MapsHandler.getArea().time||FSM.MapsHandler.getMap().time;FSM.ItemsHolder.setItem("time",Number(time));};FullScreenMario.prototype.setLocation=function(name){if(name===void 0){name=0;}
var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),location;FSM.MapScreener.nokeys=false;FSM.MapScreener.notime=false;FSM.MapScreener.canscroll=true;FSM.MapScreener.clearScreen();FSM.GroupHolder.clearArrays();FSM.TimeHandler.cancelAllEvents();FSM.MapsHandler.setLocation((name||0).toString());FSM.MapScreener.setVariables();location=FSM.MapsHandler.getLocation((name||0).toString());FSM.ModAttacher.fireEvent("onPreSetLocation",location);FSM.PixelDrawer.setBackground(FSM.MapsHandler.getArea().background);FSM.TimeHandler.addEventInterval(FSM.maintainTime,25,Infinity,FSM);FSM.TimeHandler.addEventInterval(FSM.maintainScenery,350,Infinity,FSM);FSM.AudioPlayer.clearAll();FSM.AudioPlayer.playTheme();FSM.QuadsKeeper.resetQuadrants();location.entry(FSM,location);FSM.ModAttacher.fireEvent("onSetLocation",location);FSM.GamesRunner.play();};FullScreenMario.prototype.mapEntranceNormal=function(FSM,location){if(location&&location.xloc){FSM.scrollWindow(location.xloc*FSM.unitsize);}
FSM.addPlayer(FSM.unitsize*16,FSM.unitsize*16);};FullScreenMario.prototype.mapEntrancePlain=function(FSM,location){if(location&&location.xloc){FSM.scrollWindow(location.xloc*FSM.unitsize);}
FSM.addPlayer(FSM.unitsize*16,FSM.MapScreener.floor*FSM.unitsize);};FullScreenMario.prototype.mapEntranceWalking=function(FSM,location){FSM.mapEntrancePlain(FSM,location);FSM.player.keys.run=1;FSM.player.maxspeed=FSM.player.walkspeed;FSM.MapScreener.nokeys=true;FSM.MapScreener.notime=true;};FullScreenMario.prototype.mapEntranceCastle=function(FSM){FSM.addPlayer(FSM.unitsize*2,FSM.unitsize*56);};FullScreenMario.prototype.mapEntranceVine=function(FSM){var threshold=(FSM.MapScreener.bottom-FSM.unitsize*40),vine=FSM.addThing("Vine",FSM.unitsize*32,FSM.MapScreener.bottom+FSM.unitsize*8);FSM.TimeHandler.addEventInterval(function(){if(vine.top>=threshold){return false;}
vine.movement=undefined;FSM.mapEntranceVinePlayer(FSM,vine);return true;},1,Infinity);};FullScreenMario.prototype.mapEntranceVinePlayer=function(FSM,vine){var threshold=(FSM.MapScreener.bottom-FSM.unitsize*24),speed=FSM.unitsize/-4,player=FSM.addPlayer(FSM.unitsize*29,FSM.MapScreener.bottom-FSM.unitsize*4);FSM.shiftVert(player,player.height*FSM.unitsize);FSM.collideVine(player,vine);FSM.TimeHandler.addEventInterval(function(){FSM.shiftVert(player,speed);if(player.top<threshold){FSM.TimeHandler.addEvent(FSM.animatePlayerOffVine,49,player);return true;}
return false;},1,Infinity);};FullScreenMario.prototype.mapEntrancePipeVertical=function(FSM,location){if(location&&location.xloc){FSM.scrollWindow(location.xloc*FSM.unitsize);}
FSM.addPlayer(location.entrance.left+FSM.player.width*FSM.unitsize/2,location.entrance.top+FSM.player.height*FSM.unitsize);FSM.animatePlayerPipingStart(FSM.player);FSM.AudioPlayer.play("Pipe");FSM.AudioPlayer.addEventListener("Pipe","ended",function(){FSM.AudioPlayer.playTheme();});FSM.TimeHandler.addEventInterval(function(){FSM.shiftVert(FSM.player,FSM.unitsize/-4);if(FSM.player.bottom<=location.entrance.top){FSM.animatePlayerPipingEnd(FSM.player);return true;}
return false;},1,Infinity);};FullScreenMario.prototype.mapEntrancePipeHorizontal=function(FSM,location){throw new Error("mapEntrancePipeHorizontal is not yet implemented.");};FullScreenMario.prototype.mapEntranceRespawn=function(FSM){FSM.MapScreener.nokeys=false;FSM.MapScreener.notime=false;FSM.MapScreener.canscroll=true;FSM.addPlayer(FSM.unitsize*16,0);FSM.animateFlicker(FSM.player);if(!FSM.MapScreener.underwater){FSM.playerAddRestingStone(FSM.player);}
FSM.ModAttacher.fireEvent("onPlayerRespawn");};FullScreenMario.prototype.mapExitPipeVertical=function(thing,other){if(!thing.resting||typeof(other.transport)==="undefined"||thing.right+thing.FSM.unitsize*2>other.right||thing.left-thing.FSM.unitsize*2<other.left){return;}
thing.FSM.animatePlayerPipingStart(thing);thing.FSM.AudioPlayer.play("Pipe");thing.FSM.TimeHandler.addEventInterval(function(){thing.FSM.shiftVert(thing,thing.FSM.unitsize/4);if(thing.top<=other.top){return false;}
thing.FSM.TimeHandler.addEvent(function(){if(other.transport.constructor===Object){thing.FSM.setMap(other.transport.map);}
else{thing.FSM.setLocation(other.transport);}},42);return true;},1,Infinity);};FullScreenMario.prototype.mapExitPipeHorizontal=function(thing,other,shouldTransport){if(!shouldTransport&&!thing.resting&&!thing.paddling){return;}
if(thing.top<other.top||thing.bottom>other.bottom){return;}
if(!thing.keys.run){return;}
thing.FSM.animatePlayerPipingStart(thing);thing.FSM.AudioPlayer.play("Pipe");thing.FSM.TimeHandler.addEventInterval(function(){thing.FSM.shiftHoriz(thing,thing.FSM.unitsize/4);if(thing.left<=other.left){return false;}
thing.FSM.TimeHandler.addEvent(function(){thing.FSM.setLocation(other.transport);},42);return true;},1,Infinity);};FullScreenMario.prototype.initializeArea=function(){var scope=this,i;if(scope.attributes){for(i in scope.attributes){if(scope.hasOwnProperty(i)&&scope[i]){FullScreenMario.prototype.proliferate(scope,scope.attributes[i]);}}}
scope.setBackground(scope);};FullScreenMario.prototype.setAreaBackground=function(area){if(area.setting.indexOf("Underwater")===-1&&(area.setting.indexOf("Underworld")!==-1||area.setting.indexOf("Castle")!==-1||area.setting.indexOf("Night")!==-1)){area.background="#000000";}
else{area.background="#5c94fc";}};FullScreenMario.prototype.getAbsoluteHeight=function(yloc,correctUnitsize){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),height=yloc+FSM.MapScreener.height;if(!correctUnitsize){height*=FSM.unitsize;}
return height;};FullScreenMario.prototype.mapAddStretched=function(prethingRaw){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),boundaries=FSM.MapsHandler.getArea().boundaries,prething=prethingRaw instanceof String?{"thing":prething}:prethingRaw,y=((FSM.MapScreener.floor-prething.y)*FSM.unitsize),thing=FSM.ObjectMaker.make(prething.thing,{"width":boundaries.right-boundaries.left,"height":prething.height||FSM.getAbsoluteHeight(prething.y)});return FSM.addThing(thing,boundaries.left,y);};FullScreenMario.prototype.mapAddAfter=function(prethingRaw){var FSM=FullScreenMario.prototype.ensureCorrectCaller(this),MapsCreator=FSM.MapsCreator,MapsHandler=FSM.MapsHandler,prethings=MapsHandler.getPreThings(),prething=prethingRaw instanceof String?{"thing":prething}:prethingRaw,area=MapsHandler.getArea(),map=MapsHandler.getMap(),boundaries=FSM.MapsHandler.getArea().boundaries;prething.x=boundaries.right;MapsCreator.analyzePreSwitch(prething,prethings,area,map);};FullScreenMario.prototype.cutsceneFlagpoleStartSlidingDown=function(FSM,settings){var thing=settings.player,other=settings.collider,height=(other.bottom-thing.bottom)|0,scoreAmount=FSM.scorePlayerFlag(thing,height/FSM.unitsize),scoreThing=FSM.ObjectMaker.make("Text"+scoreAmount);thing.star=1;thing.nocollidechar=true;FSM.MapScreener.nokeys=true;FSM.MapScreener.notime=true;FSM.MapScreener.canscroll=false;FSM.killNPCs();FSM.thingPauseVelocity(thing);FSM.setRight(thing,other.left+FSM.unitsize*3);FSM.killNormal(other);FSM.removeClasses(thing,"running jumping skidding");FSM.addClass(thing,"climbing animated");FSM.TimeHandler.addClassCycle(thing,["one","two"],"climbing",0);FSM.TimeHandler.addEventInterval(FSM.shiftVert,1,64,other.collection.Flag,FSM.unitsize);FSM.addThing(scoreThing,other.right,other.bottom);FSM.TimeHandler.addEventInterval(FSM.shiftVert,1,72,scoreThing,-FSM.unitsize);FSM.TimeHandler.addEvent(FSM.ItemsHolder.increase.bind(FSM.ItemsHolder),72,"score",scoreAmount);FSM.AudioPlayer.clearAll();FSM.AudioPlayer.clearTheme();FSM.AudioPlayer.play("Flagpole");FSM.TimeHandler.addEventInterval(function(){if(thing.bottom<other.bottom){FSM.shiftVert(thing,FSM.unitsize);return false;}
if((other.collection.Flag.bottom|0)<(other.bottom|0)){return false;}
thing.movement=undefined;FSM.setBottom(thing,other.bottom);FSM.TimeHandler.cancelClassCycle(thing,"climbing");FSM.TimeHandler.addEvent(FSM.ScenePlayer.bindRoutine("HitBottom"),21);return true;},1,Infinity);};FullScreenMario.prototype.cutsceneFlagpoleHitBottom=function(FSM,settings){var thing=settings.player;thing.keys.run=1;thing.maxspeed=thing.walkspeed;thing.FSM.flipHoriz(thing);thing.FSM.shiftHoriz(thing,(thing.width+1)*thing.FSM.unitsize);thing.FSM.TimeHandler.addEvent(function(){thing.FSM.AudioPlayer.play("Stage Clear");thing.FSM.animatePlayerOffPole(thing,true);},14);};FullScreenMario.prototype.cutsceneFlagpoleCountdown=function(FSM,settings){FSM.TimeHandler.addEventInterval(function(){FSM.ItemsHolder.decrease("time");FSM.ItemsHolder.increase("score",50);FSM.AudioPlayer.play("Coin");if(FSM.ItemsHolder.getItem("time")>0){return false;}
FSM.TimeHandler.addEvent(FSM.ScenePlayer.bindRoutine("Fireworks"),35);return true;},1,Infinity);};FullScreenMario.prototype.cutsceneFlagpoleFireworks=function(FSM,settings){var numFireworks=FSM.MathDecider.compute("numberOfFireworks",settings.time),player=settings.player,detector=settings.detector,doorRight=detector.left,doorLeft=doorRight-FSM.unitsize*8,doorBottom=detector.bottom,doorTop=doorBottom-FSM.unitsize*16,flag=FSM.ObjectMaker.make("CastleFlag",{"position":"beginning"}),flagMovements=28,fireInterval=28,fireworkPositions=[[0,-48],[-8,-40],[8,-40],[-8,-32],[0,-48],[-8,-40]],i=0,firework,position;FSM.addThing(flag,doorLeft+FSM.unitsize,doorTop-FSM.unitsize*24);FSM.arrayToBeginning(flag,FSM.GroupHolder.getGroup(flag.groupType));FSM.TimeHandler.addEventInterval(function(){FSM.shiftVert(flag,FSM.unitsize*-.25);},1,flagMovements);if(numFireworks>0){FSM.TimeHandler.addEventInterval(function(){position=fireworkPositions[i];firework=FSM.addThing("Firework",player.left+position[0]*FSM.unitsize,player.top+position[1]*FSM.unitsize);firework.animate(firework);i+=1;},fireInterval,numFireworks);}
FSM.TimeHandler.addEvent(function(){FSM.AudioPlayer.addEventImmediate("Stage Clear","ended",function(){FSM.collideLevelTransport(player,detector);FSM.ScenePlayer.stopCutscene();});},i*fireInterval+420);};FullScreenMario.prototype.cutsceneBowserVictoryCollideCastleAxe=function(FSM,settings){var player=settings.player,axe=settings.axe;FSM.thingPauseVelocity(player);FSM.killNormal(axe);FSM.killNPCs();FSM.AudioPlayer.clearTheme();FSM.MapScreener.nokeys=true;FSM.MapScreener.notime=true;player.FSM.TimeHandler.addEvent(function(){player.keys.run=1;player.maxspeed=player.walkspeed;FSM.thingResumeVelocity(player);player.yvel=0;FSM.MapScreener.canscroll=true;FSM.AudioPlayer.play("World Clear");},140);};FullScreenMario.prototype.cutsceneBowserVictoryCastleBridgeOpen=function(FSM,settings){var bridge=settings.routineArguments[0];FSM.TimeHandler.addEventInterval(function(){bridge.right-=FSM.unitsize*2;FSM.setWidth(bridge,bridge.width-2);FSM.AudioPlayer.play("Break Block");if(bridge.width<=0){FSM.ScenePlayer.playRoutine("BowserFalls");return true;}
return false;},1,Infinity);};FullScreenMario.prototype.cutsceneBowserVictoryBowserFalls=function(FSM,settings){FSM.AudioPlayer.play("Bowser Falls");settings.bowser.nofall=true;};FullScreenMario.prototype.cutsceneBowserVictoryDialog=function(FSM,settings){var player=settings.player,detector=settings.detector,keys=settings.keys,interval=140,i=0,j,letters;player.keys.run=0;player.FSM.killNormal(detector);player.FSM.TimeHandler.addEventInterval(function(){letters=detector.collection[keys[i]].children;for(j=0;j<letters.length;j+=1){if(letters[j].title!=="TextSpace"){letters[j].hidden=false;}}
i+=1;},interval,keys.length);player.FSM.TimeHandler.addEvent(function(){player.FSM.collideLevelTransport(player,detector);},280+interval*keys.length);};FullScreenMario.prototype.macroExample=function(reference,prethings,area,map,scope){console.log("This is a macro that may be called by a map creation.");console.log("The arguments are:\n");console.log("Reference (the listing from area.creation):  ",reference);console.log("Prethings (the area's listing of prethings): ",prethings);console.log("Area      (the currently generated area):    ",area);console.log("Map       (the map containing the area):     ",map);console.log("Scope     (the custom scope container):      ",scope);};FullScreenMario.prototype.macroFillPreThings=function(reference,prethings,area,map,scope){var defaults=scope.ObjectMaker.getFullPropertiesOf(reference.thing),xnum=reference.xnum||1,ynum=reference.ynum||1,xwidth=reference.xwidth||defaults.width,yheight=reference.yheight||defaults.height,x=reference.x||0,yref=reference.y||0,outputs=[],output,o=0,y,i,j;for(i=0;i<xnum;++i){y=yref;for(j=0;j<ynum;++j){output={"x":x,"y":y,"macro":undefined};outputs.push(FullScreenMario.prototype.proliferate(output,reference,true));o+=1;y+=yheight;}
x+=xwidth;}
return outputs;};FullScreenMario.prototype.macroFillPrePattern=function(reference,prethings,area,map,scope){if(!scope.settings.maps.patterns[reference.pattern]){console.warn("An unknown pattern is referenced: "+reference);return;}
var pattern=scope.settings.maps.patterns[reference.pattern],length=pattern.length,defaults=scope.ObjectMaker.getFullProperties(),repeats=reference.repeat||1,xpos=reference.x||0,ypos=reference.y||0,outputs=[],o=0,skips={},prething,output,i,j;if(typeof reference.skips!=="undefined"){for(i=0;i<reference.skips.length;i+=1){skips[reference.skips[i]]=true;}}
for(i=0;i<repeats;i+=1){for(j=0;j<length;j+=1){if(skips[j]){continue;}
prething=pattern[j];output={"thing":prething[0],"x":xpos+prething[1],"y":ypos+prething[2]};output.y+=defaults[prething[0]].height;if(prething[3]){output.width=prething[3];}
outputs.push(output);o+=1;}
xpos+=pattern.width;}
return outputs;};FullScreenMario.prototype.macroFloor=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,floor=FullScreenMario.prototype.proliferate({"thing":"Floor","x":x,"y":y,"width":(reference.width||8),"height":"Infinity"},reference,true);floor.macro=undefined;return floor;};FullScreenMario.prototype.macroPipe=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,height=reference.height||16,pipe=FullScreenMario.prototype.proliferate({"thing":"Pipe","x":x,"y":y,"width":16,"height":reference.height||8},reference,true),output=[pipe];pipe.macro=undefined;if(height==="Infinity"){pipe.height=scope.MapScreener.height;}
else{pipe.y+=height;}
if(reference.piranha){output.push({"thing":"Piranha","x":x+4,"y":pipe.y+12,"onPipe":true});}
return output;};FullScreenMario.prototype.macroPipeCorner=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,height=reference.height||16,output=[{"thing":"PipeHorizontal","x":x,"y":y,"transport":reference.transport||0},{"thing":"PipeVertical","x":x+16,"y":y+height-16,"height":height}];if(reference.scrollEnabler){output.push({"thing":"ScrollEnabler","x":x+16,"y":y+height+48,"height":64,"width":16});}
if(reference.scrollBlocker){output.push({"thing":"ScrollBlocker","x":x+32});}
return output;};FullScreenMario.prototype.macroTree=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,width=reference.width||24,output=[{"thing":"TreeTop","x":x,"y":y,"width":width}];if(width>16){output.push({"thing":"TreeTrunk","x":x+8,"y":y-8,"width":width-16,"height":"Infinity","groupType":reference.solidTrunk?"Solid":"Scenery"});}
return output;};FullScreenMario.prototype.macroShroom=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,width=reference.width||24,output=[{"thing":"ShroomTop","x":x,"y":y,"width":width}];if(width>16){output.push({"thing":"ShroomTrunk","x":x+(width-8)/2,"y":y-8,"height":Infinity,"groupType":reference.solidTrunk?"Solid":"Scenery"});}
return output;};FullScreenMario.prototype.macroWater=function(reference,prethings,area,map,scope){var x=reference.x||0,y=(reference.y||0)+2,output=FullScreenMario.prototype.proliferate({"thing":"Water","x":x,"y":y,"height":"Infinity","macro":undefined},reference,true);return output;};FullScreenMario.prototype.macroCeiling=function(reference){return{"macro":"Fill","thing":"Brick","x":reference.x,"y":88,"xnum":(reference.width/8)|0,"xwidth":8};};FullScreenMario.prototype.macroBridge=function(reference){var x=reference.x||0,y=reference.y||0,width=Math.max(reference.width||0,16),output=[];if(reference.begin){width-=8;output.push({"thing":"Stone","x":x,"y":y,"height":"Infinity"});x+=8;}
if(reference.end){width-=8;output.push({"thing":"Stone","x":x+width,"y":y,"height":"Infinity"});}
output.push({"thing":"BridgeBase","x":x,"y":y,"width":width});output.push({"thing":"Railing","x":x,"y":y+4,"width":width});return output;};FullScreenMario.prototype.macroScale=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,unitsize=scope.unitsize,widthLeft=reference.widthLeft||24,widthRight=reference.widthRight||24,between=reference.between||40,dropLeft=reference.dropLeft||24,dropRight=reference.dropRight||24,collectionName="ScaleCollection--"+[x,y,widthLeft,widthRight,dropLeft,dropRight].join(","),stringLeft={"thing":"String","x":x,"y":y-4,"height":dropLeft-4,"collectionName":collectionName,"collectionKey":"stringLeft"},stringRight={"thing":"String","x":x+between,"y":y-4,"height":dropRight-4,"collectionName":collectionName,"collectionKey":"stringRight"},stringMiddle={"thing":"String","x":x+4,"y":y,"width":between-7,"collectionName":collectionName,"collectionKey":"stringMiddle"},cornerLeft={"thing":"StringCornerLeft","x":x,"y":y},cornerRight={"thing":"StringCornerRight","x":x+between-4,"y":y},platformLeft={"thing":"Platform","x":x-(widthLeft/2),"y":y-dropLeft,"width":widthLeft,"inScale":true,"tension":(dropLeft-1.5)*unitsize,"onThingAdd":scope.spawnScalePlatform,"collectionName":collectionName,"collectionKey":"platformLeft"},platformRight={"thing":"Platform","x":x+between-(widthRight/2),"y":y-dropRight,"width":widthRight,"inScale":true,"tension":(dropRight-1.5)*unitsize,"onThingAdd":scope.spawnScalePlatform,"collectionName":collectionName,"collectionKey":"platformRight"};return[stringLeft,stringRight,stringMiddle,cornerLeft,cornerRight,platformLeft,platformRight];};FullScreenMario.prototype.macroPlatformGenerator=function(reference,prethings,area,map,scope){var output=[],direction=reference.direction||1,levels=direction>0?[0,48]:[8,56],width=reference.width||16,x=reference.x||0,yvel=direction*scope.unitsize*.42,i;for(i=0;i<levels.length;i+=1){output.push({"thing":"Platform","x":x,"y":levels[i],"width":width,"yvel":yvel,"movement":scope.movePlatformSpawn});}
output.push({"thing":"PlatformString","x":x+(width/2)-.5,"y":scope.MapScreener.floor,"width":1,"height":scope.MapScreener.height/scope.unitsize});return output;};FullScreenMario.prototype.macroWarpWorld=function(reference,prethings,area,map,scope){var output=[],x=reference.x||0,y=reference.y||0,textHeight=reference.hasOwnProperty("textHeight")?reference.textHeight:8,warps=reference.warps,collectionName="WarpWorldCollection-"+warps.join("."),keys=[],i;output.push({"thing":"CustomText","x":x+8,"y":y+textHeight+56,"texts":[{"text":"WELCOME TO WARP WORLD!"}],"textAttributes":{"hidden":true},"collectionName":collectionName,"collectionKey":"Welcomer"});output.push({"thing":"DetectCollision","x":x+64,"y":y+174,"width":40,"height":102,"activate":scope.activateWarpWorld,"collectionName":collectionName,"collectionKey":"Detector"});for(i=0;i<warps.length;i+=1){keys.push(i);output.push({"macro":"Pipe","x":x+8+i*32,"height":24,"transport":{"map":warps[i]+"-1"},"collectionName":collectionName,"collectionKey":i+"-Pipe"});output.push({"thing":"Piranha","x":x+12+i*32,"y":y+36,"collectionName":collectionName,"collectionKey":i+"-Piranha"});output.push({"thing":"CustomText","x":x+14+i*32,"y":y+32+textHeight,"texts":[{"text":String(warps[i])}],"textAttributes":{"hidden":true},"collectionName":collectionName,"collectionKey":i+"-Text"});}
if(warps.length===1){for(i=2;i<output.length;i+=1){output[i].x+=32;}}
return output;};FullScreenMario.prototype.macroCheepsStart=function(reference,prethings,area,map,scope){return{"thing":"DetectCollision","x":reference.x||0,"y":scope.MapScreener.floor,"width":reference.width||8,"height":scope.MapScreener.height/scope.unitsize,"activate":scope.activateCheepsStart};};FullScreenMario.prototype.macroCheepsStop=function(reference,prethings,area,map,scope){return{"thing":"DetectCollision","x":reference.x||0,"y":scope.MapScreener.floor,"width":reference.width||8,"height":scope.MapScreener.height/scope.unitsize,"activate":scope.activateCheepsStop};};FullScreenMario.prototype.macroBulletBillsStart=function(reference,prethings,area,map,scope){return{"thing":"DetectCollision","x":reference.x||0,"y":scope.MapScreener.floor,"width":reference.width||8,"height":scope.MapScreener.height/scope.unitsize,"activate":scope.activateBulletBillsStart};};FullScreenMario.prototype.macroBulletBillsStop=function(reference,prethings,area,map,scope){return{"thing":"DetectCollision","x":reference.x||0,"y":scope.MapScreener.floor,"width":reference.width||8,"height":scope.MapScreener.height/scope.unitsize,"activate":scope.activateBulletBillsStop};};FullScreenMario.prototype.macroLakituStop=function(reference,prethings,area,map,scope){return{"thing":"DetectCollision","x":reference.x||0,"y":scope.MapScreener.floor,"width":reference.width||8,"height":scope.MapScreener.height/scope.unitsize,"activate":scope.activateLakituStop};};FullScreenMario.prototype.macroCastleSmall=function(reference){var output=[],x=reference.x||0,y=reference.y||0,i,j;for(i=0;i<2;i+=1){output.push({"thing":"BrickHalf","x":x+i*8,"y":y+4,"position":"end"});for(j=1;j<3;j+=1){output.push({"thing":"BrickPlain","x":x+i*8,"y":y+4+j*8,"position":"end"});}}
for(i=0;i<2;i+=1){output.push({"thing":"BrickHalf","x":x+24+i*8,"y":y+4,"position":"end"});for(j=1;j<3;j+=1){output.push({"thing":"BrickPlain","x":x+24+i*8,"y":y+4+j*8,"position":"end"});}}
output.push({"thing":"CastleRailing","x":x,"y":y+24,"position":"end"});for(i=0;i<3;i+=1){output.push({"thing":"CastleRailingFilled","x":x+(i+1)*8,"y":y+24,"position":"end"});}
output.push({"thing":"CastleRailing","x":x+32,"y":y+24,"position":"end"});for(i=0;i<3;i+=1){output.push({"thing":"CastleRailing","x":x+(i+1)*8,"y":y+40,"position":"end"});}
for(i=0;i<2;i+=1){output.push({"thing":"CastleTop","x":x+8+i*12,"y":y+36,"position":"end"});}
output.push({"thing":"CastleDoor","x":x+16,"y":y+20,"position":"end"});if(reference.transport){output.push({"thing":"DetectCollision","x":x+24,"y":y+16,"height":16,"activate":FullScreenMario.prototype.collideCastleDoor,"transport":reference.transport,"position":"end"});}
return output;};FullScreenMario.prototype.macroCastleLarge=function(reference){var output=[],x=reference.x||0,y=reference.y||0,i,j;output.push({"macro":"CastleSmall","x":x+16,"y":y+48});for(i=0;i<2;i+=1){output.push({"thing":"CastleWall","x":x+i*8,"y":y+48});}
for(i=0;i<3;i+=1){output.push({"thing":"CastleDoor","x":x+16+i*16,"y":y+20,"position":"end"});for(j=0;j<2;j+=1){output.push({"thing":"BrickPlain","x":x+16+i*16,"y":y+28+j*8});output.push({"thing":"BrickHalf","x":x+16+i*16,"y":y+40+j*4});}}
for(i=0;i<2;i+=1){for(j=0;j<3;j+=1){output.push({"thing":"BrickPlain","x":x+24+i*16,"y":y+8+j*8});}
output.push({"thing":"CastleDoor","x":x+24+i*16,"y":y+44});}
for(i=0;i<5;i+=1){output.push({"thing":"CastleRailingFilled","x":x+16+i*8,"y":y+48});}
j=reference.hasOwnProperty("walls")?reference.walls:2;for(i=0;i<j;i+=1){output.push({"thing":"CastleWall","x":x+56+i*8,"y":y+48,"position":"end"});}
if(reference.transport){output.push({"thing":"DetectCollision","x":x+24,"y":y+16,"height":16,"activate":FullScreenMario.prototype.collideCastleDoor,"transport":reference.transport,"position":"end"});}
return output;};FullScreenMario.prototype.macroStartInsideCastle=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,width=(reference.width||0)-40,output=[{"thing":"Stone","x":x,"y":y+48,"width":24,"height":Infinity},{"thing":"Stone","x":x+24,"y":y+40,"width":8,"height":Infinity},{"thing":"Stone","x":x+32,"y":y+32,"width":8,"height":Infinity}];if(width>0){output.push({"macro":"Floor","x":x+40,"y":y+24,"width":width});}
return output;};FullScreenMario.prototype.macroEndOutsideCastle=function(reference){var x=reference.x||0,y=reference.y||0,collectionName="EndOutsideCastle-"+[reference.x,reference.y,reference.large].join(","),output;output=[{"thing":"DetectCollision",x:x,y:y+108,height:100,"activate":FullScreenMario.prototype.collideFlagpole,"activateFail":FullScreenMario.prototype.killNormal,"noActivateDeath":true,"collectionName":collectionName,"collectionKey":"DetectCollision"},{"thing":"Flag","x":x-4.5,"y":y+79.5,"collectionName":collectionName,"collectionKey":"Flag"},{"thing":"FlagTop","x":x+1.5,"y":y+84,"collectionName":collectionName,"collectionKey":"FlagTop"},{"thing":"FlagPole","x":x+3,"y":y+80,"collectionName":collectionName,"collectionKey":"FlagPole"},{"thing":"Stone","x":x,"y":y+8,"collectionName":collectionName,"collectionKey":"FlagPole"},];if(reference.large){output.push({"macro":"CastleLarge","x":x+(reference.castleDistance||24),"y":y,"transport":reference.transport,"walls":reference.walls||8});}
else{output.push({"macro":"CastleSmall","x":x+(reference.castleDistance||32),"y":y,"transport":reference.transport});}
return output;};FullScreenMario.prototype.macroEndInsideCastle=function(reference,prethings,area,map,scope){var x=reference.x||0,y=reference.y||0,npc=reference.npc||"Toad",output,texts,keys;if(npc==="Toad"){keys=["1","2"];texts=[{"thing":"CustomText","x":x+164,"y":y+64,"texts":[{"text":"THANK YOU MARIO!"}],"textAttributes":{"hidden":true},"collectionName":"endInsideCastleText","collectionKey":"1"},{"thing":"CustomText","x":x+152,"y":y+48,"texts":[{"text":"BUT OUR PRINCESS IS IN"},{"text":"ANOTHER CASTLE!"}],"textAttributes":{"hidden":true},"collectionName":"endInsideCastleText","collectionKey":"2"}];}
else if(npc==="Peach"){keys=["1","2","3"];texts=[{"thing":"CustomText","x":x+164,"y":y+64,"texts":[{"text":"THANK YOU MARIO!"}],"textAttributes":{"hidden":true},"collectionName":"endInsideCastleText","collectionKey":"1"},{"thing":"CustomText","x":x+152,"y":y+48,"texts":[{"text":"YOUR QUEST IS OVER.","offset":12},{"text":"WE PRESENT YOU A NEW QUEST."}],"textAttributes":{"hidden":true},"collectionName":"endInsideCastleText","collectionKey":"2"},{"thing":"CustomText","x":x+152,"y":32,"texts":[{"text":"PRESS BUTTON B","offset":8},{"text":"TO SELECT A WORLD"}],"textAttributes":{"hidden":true},"collectionName":"endInsideCastleText","collectionKey":"3"}];}
output=[{"thing":"Stone","x":x,"y":y+88,"width":256},{"macro":"Water","x":x,"y":y,"width":104},{"thing":"CastleBridge","x":x,"y":y+24,"width":104},{"thing":"Bowser","x":x+69,"y":y+42,"hard":reference.hard,"spawnType":reference.spawnType||"Goomba","throwing":reference.throwing},{"thing":"CastleChain","x":x+96,"y":y+32},{"thing":"CastleAxe","x":x+104,"y":y+40},{"thing":"ScrollBlocker","x":x+112},{"macro":"Floor","x":x+104,"y":y,"width":152},{"thing":"Stone","x":x+104,"y":y+32,"width":24,"height":32},{"thing":"Stone","x":x+112,"y":y+80,"width":16,"height":24},{"thing":"DetectCollision","x":x+180,"activate":scope.collideCastleNPC,"transport":reference.transport,"collectionName":"endInsideCastleText","collectionKey":"npc","collectionKeys":keys},{"thing":npc,"x":x+200,"y":13},{"thing":"ScrollBlocker","x":x+256}];if(reference.topScrollEnabler){output.push({"thing":"ScrollEnabler","x":x+96,"y":y+140,"height":52,"width":16});output.push({"thing":"ScrollEnabler","x":x+240,"y":y+140,"height":52,"width":16});}
output.push.apply(output,texts);return output;};FullScreenMario.prototype.macroSection=function(reference,prethings,area,map,scope){return{"thing":"DetectSpawn","x":reference.x||0,"y":reference.y||0,"activate":scope.activateSectionBefore,"section":reference.section||0};};FullScreenMario.prototype.macroSectionPass=function(reference,prethings,area,map,scope){return{"thing":"DetectCollision","x":reference.x||0,"y":reference.y||0,"width":reference.width||8,"height":reference.height||8,"activate":function(thing){thing.FSM.MapScreener.sectionPassed=true;}};};FullScreenMario.prototype.macroSectionFail=function(reference,prethings,area,map,scope){return[{"thing":"DetectCollision","x":reference.x,"y":reference.y,"width":reference.width||8,"height":reference.height||8,"activate":function(thing){thing.FSM.MapScreener.sectionPassed=false;}}];};FullScreenMario.prototype.macroSectionDecider=function(reference,prethings,area,map,scope){return{"thing":"DetectSpawn","x":reference.x||0,"y":reference.y||0,"activate":function(thing){if(thing.FSM.MapScreener.sectionPassed){thing.section=reference.pass||0;}
else{thing.section=reference.fail||0;}
thing.FSM.activateSectionBefore(thing);}};};FullScreenMario.prototype.ensureCorrectCaller=function(current){if(!(current instanceof FullScreenMario)){throw new Error("A function requires the scope ('this') to be the "
+"manipulated FullScreenMario object. Unfortunately, 'this' is a "
+typeof(this)+".");}
return current;};FullScreenMario.settings={"audio":undefined,"collisions":undefined,"devices":undefined,"editor":undefined,"generator":undefined,"groups":undefined,"events":undefined,"input":undefined,"math":undefined,"maps":undefined,"mods":undefined,"objects":undefined,"quadrants":undefined,"renderer":undefined,"runner":undefined,"scenes":undefined,"sprites":undefined,"statistics":undefined,"touch":undefined,"ui":undefined};FullScreenMario.unitsize=4;FullScreenMario.scale=2;FullScreenMario.gravity=Math.round(12*FullScreenMario.unitsize)/100;FullScreenMario.pointLevels=[100,200,400,500,800,1000,2000,4000,5000,8000];FullScreenMario.customTextMappings={" ":"Space",".":"Period","!":"ExclamationMark",":":"Colon","/":"Slash","©":"Copyright"};return FullScreenMario;})(GameStartr.GameStartr);FullScreenMario_1.FullScreenMario=FullScreenMario;})(FullScreenMario||(FullScreenMario={}));